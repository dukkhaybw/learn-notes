需求：

1. 实现一套基于文档的审批流程，审批流程的逻辑：首先被审批人上传相关的Word或PDF文档，然后发起审批流，这个文档进入审批流程

2. 这个审批在进入审批状态后，将会被一个或多个审批人审批

3. 审批人可以在被审批人上传的PDF文档上增加、删除、修改、查看、移动、定位各种批注信息

4. 对于不同的批注，不同的审批人具有不同的操作权限

   

开发要求：

1. 把PDF的展示和批注管理实现

PDF.js本身提供的功能主要是面向文档展示，除了展示相关的功能之外，只提供了较少的批注功能，并且没有直接操作批注的API。也只留下了较少扩展的接口让开发者将自己的代码加入到PDF.js的流程当中去。将PDF.js集成进去也比较困难。因此需要对PDF.js进行一系列的改造，进而将PDF.js完全的融入到业务系统当中去，并且能够给使用者一个完美的功能体验。





为了实现上面提到的功能和目标，在PDF.js-4.0.379版本的源码的基础上做了较多的改动，也添加了不少新代码。虽然改动涉及了比较多的内容，但是大体上可以通过两个视角来看待这些内容。 一个是功能的视角，一个是代码的视角。

从功能的视角来看，做出的改动和新增的功能有：

1. 批注分离功能。通过改造批注相关的类、函数和生成逻辑，添加了一系列的API，让使用者直接高效的操作批注。
2. 新增四类批注——框选、下划线、删除、指向箭头。
3. 根据实际使用情况，对现有批注进行改进，增加一些新的信息，如高亮时的文本信息等，并对原来的批注做一定的改动
4. 新增一些参数供用户自由的操作PDF.js。包括指定加载页数参数：loadPageIndex。控制批注操作权限：permitToEdit。控制分片大小rangeChunkSize。
5. 初始化批注功能，在页面加载完毕后，自动将历史的批注从后台读取并渲染出来。
6. 高效批注分片加载，PDF的Catalog组织情况、PDF对象引用结构调整以及解决跨域问题。
7. 给批注控制增加权限管理，业务系统可以通过权限字段控制批注是否可编辑。

























