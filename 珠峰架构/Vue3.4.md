vue3.4源码和之前源码的变化对比

使用时注意事项和技巧



1. vue3开发环境搭建，设计理念和整体架构
2. vue3生产环境打包上线，monorep项目版本管理
3. vue3中的响应式原理中的核心api，reactive，effect，watch，computed，ref等



设计理念：

1. 声明式框架，使用简单

   vue3比较灵活，既可以写声明式代码，也可以写命令式的代码实现业务逻辑。写业务的使用可以使用vue3的组合式api，以命令式的方式编写自己的业务代码。关于真实的DOM元素的操作是交给Vue的底层去处理。 

2. 采用虚拟DOM

   先将源代码变为虚拟DOM，在解析渲染虚拟DOM为真实DOM插入到页面中，这样的好处是在操作更新的使用可以进行diff比较，最后再最小化更新。

   同时虚拟DOM可以更好的跨平台，服务端渲染时，将模板字符串转为html字符串，单元测试中使用虚拟DOM，canvas绘图也可以借助虚拟DOM标识canvas元素。

3. vue中提供了编译时和运行时两部分

   模板=>js函数调用=>虚拟DOM=>真实DOM。

   不在代码交给浏览器运行的时候，再去解析模板，生产函数调用（这样性能不够好，需要浏览器执行的时候，现场解析模板得到对应js函数调用），而是将这一步提前在项目编译打包的这个工程化的阶段去处理，生产的代码就是直接的js函数调用代码，再交给浏览器后，浏览器就直接调用执行这些函数，得到虚拟DOM，再生产真实DOM并挂在到页面上。

   模板=>js函数调用代码的生成：这一步交给编译时库在编译打包阶段提前处理。

   js函数调用=>虚拟DOM=>真实DOM：这一步交给浏览器去解析执行。

   

vue3的设计思想：

- 注重模块之间的拆分，模块间的耦合度非常低
- 基于组合式API，借鉴函数式编程思想实现，方便tree-shaking按需引入，减少打包体积
- vue3增强了扩展能力，用户可以自定义不同平台的渲染器，同时底层提供一套默认的渲染器（DOM渲染）





Vue3仓库的整体架构：

vue3源码分为一个个的模块，使用一个monorepo方式来在一个仓库下管理多个项目。每个项目不用单独发布，版本号的管理和统一打包都更方便。每个项目之间也可以相互依赖。 

使用pnpm去搭建和管理monorepo仓库。



vue3项目的整体结构：

![image-20240521221538951](D:\learn-notes\珠峰架构\images\image-20240521221538951.png)

![image-20240521221710466](D:\learn-notes\珠峰架构\images\image-20240521221710466.png)