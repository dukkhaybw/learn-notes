# 计算机网络

课程目标：

掌握计算机网络的以下这些

- 基本概念
- 工作原理
- 常用技术和协议
- 为后面学习、应用和研究计算机网络打基础

学习建议：

**对于知识技能更新速度非常快的领域，最长远的做法是掌握最基本的原理、技术和协议，常见的一些思维方法，思考问题的方法。有了这些基础，对于新出现的技术和知识，就能很快的进行学习和吸收。同时学会抓重点。**



课程特点：

- 计算机网络的重点就在那些大量的概念和术语。
- 计算机网络中涉及的推理是定性的逻辑描述的推理（不同于数学逻辑推理），很多概念和原理使用表述性的方式来讲述的。
- 各种概念之间的关系，推理过程，包含关系等。



课程基本内容：

- 计算机网络导论：介绍大量关键术语和概念，计算机网络工作的原理和基本框架，计算机网络发展史。（解答：是什么，怎么工作）

  

- 应用层

- 传输层

- 网络层：数据平面

- 网络层：控制平面

- 数据链路层、局域网和物理层（更接近通信原理课程）

  

- 网络安全
   网络安全的特性和怎么实现网络安全

- 无线和移动网络

  两者的差别，技术的不同

- 多媒体网络

  介绍网络中有哪些多媒体应用和这些应用对网络的需求，下层协议是如何更好的支撑这些多媒体应用的，各层做的工作

- 网络管理  

  

每章分为两部分：

- 原理部分（本层的功能，和提供的服务和怎么实现）重点在原理的讲解，每层主要的功能和为上层提供的服务，每一层向上层提供接口服务，本层功能的实现需要调用下层提供的接口才能实现（**分层**）

  原理重点讲解：本层功能如何借助于下层提供的服务，怎样在本层功能实体的内部，采用各种各样的软硬件，实现自己的功能，再通过接口向上层提供更完善的服务。

- 实例部分讲解当前所在层的典型的通信协议（应用层：http（web应用），ftp（文件传输应用），smtp/pop3（电子邮件应用）；传输层：TCP，UDP）

- 不同协议提供的服务特性是不一样的，一些应用对可靠性要求高对实时性要求不高，一些相反。



传输层的 TCP 协议实体向上层提供的是可靠的数据传输服务，可靠的特征：

1. 不出错

2. 不乱序

3. 不重复

4. 不丢失



为了提高可靠性，必须实现以下情况：

1. 发送数据报后，在收到对方的确认之前，自己必须留有副本，以应对丢失后重传
2. 发送的数据报可能乱序到达，所以需要在发送前一一编号
3. 每个数据包都需要彼此的确认
4. 出错后的重传，超时重传
5. 校验数据报完整性
6. 排序



**对于事务性的应用，或者实时性要求高的应用一般都使用的是 UDP 协议。事务性的应用只需要一次单次往返通信就可以达到目的的应用。**

 

应用层的协议是在传输层提供服务基础上，两个远程的应用进程之间的通信交互，应用层协议规范了两个远程应用进程之间通信的规则（规则包括语法，语言和时序），传输层为网络应用进程提供服务的。 

传输层是在网络层提供的是**端到端**的服务基础上实现的，两个主机接入互联网（端到端）之间通过很多跳实现连接。网络层提供源主机到目标主机之间的、以IP数据报为单位的数据交互。传输层在主机到主机的基础上提供了主机之上的进程之间的服务（细分：从主机到进程，加强：从不可靠到可靠）。

网络层提供的服务是尽力而为的，可能不确定是否丢包，乱序，出错等。

网络层提供的是端到端的服务，它必须要在数据链路层提供的相邻两点之间的传输服务的基础上。每一跳，从一个网卡到相邻另一个网络交换设备的网卡，是借助网卡提供的数据链路层的点到点服务实现。

点到点：包括主机到路由器，路由器到路由器，网卡到网卡等。

端到端的连接基于数据链路层的相邻的两点之间点到点的服务。从一个网卡到相邻设备的另一个网卡之间是基于数据链路层的协议实现的。 

物理层将来自数据链路层的数字信号转为物理信号（光信号或者电磁波）借助物理媒介，到达下一跳后再解析为数字信号和拆解后交给上层进行处理，以实现在相邻两点之间进行传输。



网络层的数据平面和控制平面： 

**网络层**的工作方式有两种

1. 传统方式，在网络层有两种协议，IP 协议和一些路由协议
2. SDN

在互联网的网络层分为两个协议：IP 协议和路由协议

ip协议的作用

路由协议：运行在路由器上的软件被称为路由实体，跟其他路由器的路有实体，会不停的交换一些路由报文信息（子网信息，跳转信息，延迟，是否可到达），得到这些信息后，路由器按照路由选择算法，算出路由表。 路由表包括ip子网，传输路径等等。

路由表是由路由器上的软件算出来，ip协议来使用，来了一个数据包，ip协议根据到来的数据包，查询算出来的路由表，来决定该数据包从哪个网段的网卡发出去，以及下一跳的信息。网络层主要的功能是：路由和转发。

路由由路由器上的软件实体之间交换信息，执行路由算法计算得到路由表。  当有一个数据包到达路由器后，由IP协议对到来的数据包根据路由表信息在从特定的端口转发处理。

传统方式的工作原理是写死的，不灵活，原理是来了一个分组（数据帧），查询之前已经通过路由实体之间通信后进过算法生成的路由表，查到分组对应的路由网段然后转发，查不带按照默认的路径转走 。  路由器设计好后不会变，很难升级。



随着网络发展，创造了一套更灵活的工作方式：SDN（软件定义网络）有数据平面（交换机）和控制平面（网络操作系统，注：不是PC上的操作系统）。在网络操作系统上运行各种网络应用，用于算流表的应用；网络应用算出流表（流表包括：源ip，目标ip，源mac，目标mac等许多字段），流表再通过标准协议，拦向接口，将流表发给数据平面的交换机，交换机将流表上载，来了分组后，将分组（数据帧）中的源ip，目标ip，源mac，目标mac等许多字段和流表中的进行匹配，根据流表描述的行为（转发，广播，拦截，改字段），来处理分组。



SDN方式和传统网络层的工作方式的不同是：

1. 使用的字段的类型不再一样，传统方式只用了目标ip，SDN方式采用源ip，目标ip，源mac，目标mac等许多字段来识别一个数据包
2. 网络应用可以自定义不同的运算方式，得到不同的流表，下发给交换机
3. 交换机根据匹配完的流表，可以进行许多不同的动作而不仅仅只有转发



可以看出SDN方式提供的功能中包含了传统方式的只是转发的功能，在SDN的情况下，去实现各种网络功能，以前各种网络设备（防火墙，路由器，交换机，负载均衡设备）都可以统一到一个框架下，对运营商来说只需要部署SDN交换机，该交换机上跑一些SDN的网络操作系统及其应用，需要什么网络功能，就在该操作系统中部署相应功能的应用就能解决。

在传统的网络层的工作方式当中，IP协议就是转发分组，行为僵化，来了分组，跟路由表匹配目标IP，找到相应的表项，动作只有一个：进行转发。这样的网络是僵化的，不可编程的。在SDN的方式下，则是可编程的，网络运营商在部署各种新的网络应用时，在SDN部署完后，很快就能在此基础上实现新的功能。



会区分并讲解传统方式和SDN方式下的网络层控制平面（传统方式下的控制平面：路由  和  SDN方式下的控制平面：网络操作系统，他的功能和组成应用和工作原理）



数据链路层是在物理层提供的服务基础上，传输相邻两点之间的以帧为单位的数据的。



计算机通信过程和通信协议。

- 电信网络（电话，手机）
- 计算机网络（计算机通信）
  - 因特网
  - 其他网络（政府，军队等）
- 有线电视网络（电视，一般是单项的，点播电视就是双向）

计算机网络的功能：

- 连通行，计算机彼此连通，交换信息
- 共享，信息，软件硬件共享
  - 软件共享：比如云服务器，用户可以在远端通过电脑连接登录到服务器，并使用服务器中安装好的软件
  - 硬件共享，局域网中，一台电脑连接了打印机，另一台没有连接，这时前一台电脑可以共享打印机，那后一台就可以通过网络去使用打印机



## 第一章（概论）

### 要点 

- 了解计算机网络主要的概念和术语
- 掌握网络的基本工作原理，网络是什么，基本工作原理
- 为后面那些章节打下**概念和框架性和术语**的一个基础
- 什么是网络，什么是计算机网络，什么是互联网以及组成
- 支撑网络工作的协议，什么是协议
- 边缘网络，接入网络（中间网络）和核心网络的组成，作用和工作原理 和 物理媒介
- 网络的工作方式：分组交换和线路交换的工作原理，优缺点
- Internet/ISP分层结构，每一层的作用
- 计算机性能指标，各种延迟
- OSI 七层参考模型
- 企业中的局域网和广域网
- 计算机使用 TCP/IP 协议族通信过程
- 数据的封装和解封过程
- 集线器，交换机和路由器的工作和所属层
- 计算机网络分类
- 局域网设计







### 什么是互联网

**什么是网络**

各种动物界，人类界的实体或者抽象**节点和边**组成的网状结构（拓扑）。



**什么是计算机网络**

联网的计算机构成的系统。计算机网络中的典型节点：主机及其上面运行的应用程序，各种联网家电，数据交换节点（路由器，交换机，高层的负载均衡设备等）。

节点有主机节点，数据交换节。像路由器交换机，它既不是源，也不是目标，来个分组，从一个端口进来按照一定的工作方式（如果是交换机的话，按照目标mac地址决定从这个方向转；如果是路由器的话，通过这个网络的这个端口输进来，通过网卡查路由表，决定从某个方向放出去）。路由器和交换机只是工作层次不同，作用不同，路由器是工作在网络层的，交换机是工作在链路层的。

各种节点之间通过链路相连。链路的分类：1. 将主机与数据交换节点相连的接入网链路；2. 数据交换节点之间相连的骨干链路。

上面是物理意义上的节点和边。  计算机网络还包括在这些节点上运行的各种协议（规则）。

各个层有各层的协议（物理层，链路层，传输层，应用层协议）。每层的协议可能有若干种。对等成实体在通信过程当中应该遵守的规则的集合。





**什么是互联网**

互联网是由一堆的网络通过网络互联设备（路由器）链接构成的网络的网络。不同的网络处在互联网中的层次也是不同的或者跨层的。

互联网中是以分组交换的方式来进行工作的，分组交换必然涉及丢包，分组传出的延迟（四大延迟）衡量分组交换一个非常重要的指标是：吞吐量。

指一个以TCP/IP为主的一簇协议来支撑工作的那个计算机网络。

互联网的端节点：

- 主机端系统，端系统包括：硬件，操作系统，网络应用
- 运行网络应用程序

通信链路：

- 光纤，同轴电缆，无线电，卫星

  

各种协议：

协议：对等层实体，在通信过程当中应该遵守的规则的集合，规定了语法，语义和时序。





互联网是一堆的网络通过网络互联设备（路由器）链接在一起的网络的网络。不同的网络所处在互联网中的层次也是不一样的。

互联网中的IP网络是按照分组交换的方式来工作的，分组交换必然涉及丢包，各种延迟（四大延迟）等。

讲述的对象：计算机网络中的子类——互联网及其协议的主要载体。

**回答什么是互联网的角度：**

1. 通过讲述互联网的具体构成（即互联网的基本硬件和软件）
2. 通过讲述互联网所服务的对象来解释互联网（为分布式应用提供服务的联网基础设施）



#### 具体构成角度

硬件和软件。

- **主机（host）**或者**端系统（end system）**：如PC，Linux工作站，服务器，路由器，交换机，调制解调器，基站，家电，智能手机，传感器等。

![image-20221022212542698](../计算机基础/images/image-20221022212542698.png)

端系统通过通信链路和分组交换机连接。

- 通信链路

  > 通信链路有多种类型物理媒体组成：同轴电缆，铜线，光纤，电话线和电磁波等。
  >
  > 不同的链路的传输数据的速率不同，单位是bit/s（bps）。
  > 
  >
  >
  > 端系统通过通信链路链接到分组交换机。

- 分组交换机（路由器和链路层交换机）

  > 分组交换机通过一条 入通信链路接受到达的分组，并从它的一条出通信链路转发该分组。**最典型的分组交换机：路由器和链路层交换机。**
  >
  > **链路层交换机常用于接入网，路由器常用于核心网。**
  >
  > 

扩展：

两个端系统通信时，端系统将数据分段并为每段都加上首部字节，这样的信息包被称为**分组（packet）**。

从发送端系统到接收端系统，一个分组所经历的一系列通信链路和分组交换机称为通过该网络的**路径（mute或path）**。

- 各层级ISP

> 端系统通过**互联网服务提供商**（ISP）接入互联网。**每个ISP自身就是一个由多台分组交换机和多段通信链路组成的网络**，ISP有许多分级。
>
> 各级ISP可以为端系统提供不同类型（速度和费用也不同）的网络接入，类型有：
>
> 1. 线缆调制解调器或者DSL宽带接入
> 2. 高速局域网接入
> 3. 移动无线接入
> 4. 通过光纤等直接接入ISP的核心路由（主要面向企业）
>
> 各级ISP之间也是互联的，低层级的ISP通过高层级ISP互相连接。  高层级的ISP之间通过**高速光纤链路**和**高速路由器**链接。
>
> 每一层的ISP网络都是独立管理的，运行着IP协议，遵从一定的命名规则和地址规则。

- 协议

  各种端系统，分组交换机和其他网络设备上都运行一系列的协议（protocol）。这些协议控制分组的接受和转发



#### 服务对象角度

从**为应用程序提供服务的基础设施**角度来描述互联网（互联网是一套基础设施）。

典型的应用程序有：

1. 电子邮件服务应用
2. web应用
3. 移动端App应用
4. PC端应用

因为这些应用程序**涉及多个在不同的端系统之间的**相互交换数据，所以被称为**分布式应用程序(distributed applicalion)**。这些应用都是运行在端系统中上的，不运行在分组交换机中，而分组交换机只是传输端系统之间需要交流的数据。

通过高级语言编写应用程序，将程序放到不同的端系统中，这些应用之间就需要互相通信，通信基于的就是互联网这个平台进行的。与互联网相连的端系统中提供了一个套接字接口（socket interface）。该接口**规定**了运行在一个端系统上的程序调用互联网基础设施向运行在另一个端系统上的特定目的地程序交付数据的方式。

因特网套接字接口是一套发送程序必须遵循的规则集合。



---



### 协议

什么是协议， 协议的作用。

协议规定了发送和接收的报文格式，以及这些报文发送和接收或其他事件出现时所采取的动作。为了完成一项工作，要求两个（或多个 ）通信实体运行相同的协议 。

<img src="../计算机基础/images/image-20221023115109298.png" alt="image-20221023115109298" style="zoom: 50%;" />



网络协议的遵守者是设备硬件和在上面运行的软件，可以根据协议交换报文，根据响应报文采取不同的行为。报文的交换以及发送和接收这些报文时所采取的动作是定义一个协议的关键元素 :

协议（ protocol）定义了在两个或多个**通信实体**之间交换的**报文的格式和顺序**，以及报文发送/接收一条报文或其他事件所采取的动作。



### 网络边缘

边缘网络，中间网络（核心网络），将边缘和中间链接起来的接入网。

#### 端系统

端系统（主机）：它们接入到了计算机网络，同时上面运行着应用程序。（主机又分为：客户端和服务器）



#### 接入网

接入网：指将端系统**在物理层面连接**到其边缘路由器 edge router）的网络。边缘路由器是端系统到任何其他远程端系统的路径上的第一台路由器。

**接入链路和接入网环境**

1. 家庭接入网（DSL，电缆，FTTH，拨号和卫星）

   家庭网络接入主要类型：

   1. 数字用户线（Digital Subscriber Line，DSL），利用电话公司现有的本地电话基础设施进行互联网接入
   
      住户通过从支持本地电话接入的本地电话公司处获取DSL互联网接入，使用DSL时，本地电话公司就是住户的ISP。
   
      每个用户的DSL 调制解调器使用现有的电话与位于电话公司的本地中心局（CO）中的数字用户线接入复用器（DSLAM）交换数据。
   
      家庭的DSL调制解调器得到数字数据后将其转换为高频音，以通过电话线传输给本地中心局；来自许多家庭 的模拟信号在DSLAM处被转换回数字形式。
   
      ![image-20230517094427056](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20230517094427056.png)
   
      电话线同时承载了数据和传统的电话信号，他们用不同的频率进行编码：
   
      1. 高速下行信道，位于50kHz到1 MHz频段；
      2. 中速上行信道，位于4kHz到50kHz频段；
      3. 普通的双向电话信道，位于0到4kHz频段。
   
      这种方法使单根DSL线路看起来就像有3根单独的线路一样，因此一个电话呼叫和一 个因特网连接能够同时共享DSL链路。（频分复用技术）
   
      在用户一 侧，一个分配器把到达家庭的数据信号和电话信号分隔开，并将数据信号转发给DSL调制解调器。
   
      在电话公司一侧，在本地中心局中，DSLAM把数据和电话信号分隔开，并将数据送往因特网。
      
   2. 电缆，利用有线电视公司的有线电视基础设施进行互联网接入
   
      住户从提供有线电视的公司获得了电缆互联网接入。光缆将电缆头端连接到地区枢纽（光纤节点），从这里使用传统的同轴电缆到达 各家各户和公寓。
   
      每个地区枢纽通常支持500-5000个家庭。因为在这个系统中应用了光纤和同轴电缆，所以它经常被称为混合光纤同轴（Hybrid Fiber Coax, HFC）系统。
   
      ![image-20230517095359721](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20230517095359721.png)
   
      电缆接入互联网需要特殊的调制解调器——电缆调制解调器（cable modem） ，该设备通过一个以太网端口连接到家用PC上。
   
      在电缆头端，电缆调制解调器端接系统（Cable Modem Termination System, CMTS）（类比DSL互联网接入中的DSLAM）将来自各个家庭中的电缆调制解调器发送的模拟信号转换回数字形式。
   
      同样，电缆调制解调器将HFC网络划分为下行和上行两个信道。两个通道的传输速率不相同，下行大于上行传输。
   
      电缆因特网接入的一个重要特征是**共享广播媒体**。特别是，由头端发送的每个分组向 下行经每段链路到每个家庭；每个家庭发送的每个分组经上行信道向头端传输。
   
      因此，如 果几个用户同时经下行信道下载一个视频文件，每个用户接收视频文件的实际速率将大大 低于电缆总计的下行速率。
   
      
   
   3. 光纤到户(Fiber To The Home, FTTH)，从本地中心局直接到家庭提供了一条光纤路径。根据具体如何分布光纤，又可以分为：
   
      - 直接光纤，从本地中心局到每户设置一根光纤。
      - 从中心局岀来的每根光纤实际上由许多家庭共享，直到相对接近这些家庭的位置，该光纤才分成每户一根光纤。
   
      在第二种方案（每根光纤由许多家庭共享）中，由分为两种光纤分布体系结构：
   
      1. 主动光纤网络（Active Optical Network, AON)，交换因特网
   
      2. 被动光纤网络(Passive Optical Network, P0N)
   
         PON：图1-7显示了使用PON分布体系结构的FTTH。每个家庭具有一个光纤网络端接器(Optical Network Termi nator, ONT),它由专门的光纤连接到邻近的分配器(splitter) o该分配器把一些家庭(通 常少于100个)集结到一根共享的光纤，该光纤再连接到本地电话和公司的中心局中的光 纤线路端接器(Optical Line Tenninator, OLT) 0该OLT提供了光信号和电信号之间的转 换，经过本地电话公司路由器与因特网相连。在家庭中，用户将一台家庭路由器(通常是 无线路由器)与ONT相连，并经过这台家庭路由器接入因特网。在PON体系结构中，所 有从OLT发送到分配器的分组在分配器(类似于一个电缆头端)处复制。
   
         ![image-20230517101719471](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20230517101719471.png)
   
         FTTH有潜力提供每秒千兆比特范围的因特网接入速率。
   
         
   
   4. 卫星，使用卫星链路将住宅以超过1Mbps的速率与互联网相连。（一般用于偏远地区）
   
   5. 传统电话线的拨 号接入与DSL基于相同的模式，家庭的调制解调器经过电话线连接到ISP的调制解调器，速度很慢



2. 企业接入网

   现在的很多家庭也采用这种方式接入互联网，使用局域网（LAN）将端系统连接到 边缘路由器（主流的局域网技术：以太网）。

   以太网用户使用双绞铜线与一台以太网交换机相连，交换机则再与更大的因特网相连。

   使用以太网接入，用户通常以100Mbps或 1Gbps速率接入以太网交换机，而服务器可能具有1Gbps甚至10Gbps的接入速率。

   无线接入，在无线LAN环境中，无线用户从一个接入点发送/接收分组，该接入点与企业网连接（很可能使用了有线以太网），企业网再与有线互联网相连。一个无线LAN用户通常必须位于接入点的几十米范围内。

   以太网和WiFi接入网最初是设置在企业（公司或大学）环境中的，但它们近来已经成为家庭网络中相当常见的部件。家庭将宽带住宅接入与无线局域网技术结合起来，以产生家用网络。

   住宅中的各种设备通过基站（无线接入点），基站再通过连接路由器，路由器连接调制解调器，再连接到本地ISP中。

   

3. 广域无线接入

   手机等移动设备通过**蜂窝网提供商**运营的基站来发送和接收分组。信号覆盖范围达到数万米。





#### 物理媒介

这些不同的互联网接入技术都使用到了不同的物理媒介，例如：HFC使用了光缆和同 轴电缆相结合的技术；DSL和以太网使用了双绞铜线；移动接入网使用了无线电频谱。

物理媒体可具有多种形状和形式，例子：包括**双绞铜线、同轴电缆、多模光纤缆、陆地无线电频 谱和卫星无线电频谱**。

物理媒体类型：

1. 导引型媒体(guided media)：电波沿着固体媒体前行，如光缆、双绞铜线或 同轴电缆。
2. 非导引型 媒体 (unguided media) ：电波在空气或外层空间中传播，例如在无线局域网或数字卫星频道中。



- 双绞铜线

  常用用于电话网；双绞线由两根绝缘的铜线组成，每根大约1mm 粗，以规则的螺旋状排列着（通常许多双绞线捆扎在一起形成一根电缆）。目前局域网中的双绞线的数据速率从10Mbps到10Gbpso所能达到的数据传输速率取决于线的粗细以及传输方和接收方之 间的距离。

- 同轴电缆

  由两个铜导体组成，但是这两个导体是同心的而不是并行的。常用于电缆电视系统。同轴电缆能被用作导引型**共享媒体**(shared medium) 。特别是，许多端系统能够直接与该电缆相连，每个端系统都能接收由其他端系统发送的内容。

- 光纤

  能传递光脉冲，每个脉冲表示一个比特。传输速率非常快，不易受到干扰，难窃听。一般用于长途传输，主干网。

- 陆地无线电信道

  传递电磁频谱中的信号。有穿透性以及长距离传递信号的能力。但距离根据采用的技术而定（几米到数万米）

- 卫星无线电信道

  一颗通信卫星连接地球上的两个或多个微波发射器/接收器，它们被称为地面站。该卫星在一个频段上接收传输，使用一个转发器再生信号，并在另一个频率上发射信号。



#### 核心网络

##### 分组交换

由连接端系统的分组交换机和链路构成的网状网络。

端系统之间的信息交换通过**报文**实现，通信时，源主机将长报文划分为小的数据块，这些数据块被称为**分组（packet）**，在源主机和目标主机之间，每个分组都通过通信链路和分组交换机（packet switch ） 传送。（交换机主要有两类：路由器（router）和链路层交换机（link-layer switch）。）

分组以等于该链路最大传输速率的速度传输通过通信链路。因此，如果某源端系统或分组交换 机经过一条链路发送一个厶比特的分组，链路的传输速率为尺比特/秒，则传输该分组的时间为**L/R秒**。



**分组交换的特点**

1. 存储转发传输，指在交换机能够开始向输岀端链路传输该分组的第一个比特之前，必须接收到来自输入端链路的一个完整的分组。

   以下图的网络作为示例：

   ![image-20230520114501209](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20230520114501209.png)

   在图1-11所示的特定时刻，源已经传输了分组1的一部分，分组1的前沿已经到达了路由器。因为该路由器应用了存储转发机 制，所以此时它还不能传输已经接收的比特，而是必须先缓存（即“存储”）该分组的比特。仅当路由器已经接收完了该分组的所有比特后，它才能开始向出链路传输（即“转 发”）该分组。

2. 排队时延

   每台分组交换机有多条链路与之相连。对于每条相连的链路，该分组交换机具有一个输出缓存（output buffer,也称为输出队列（output queue）），它用于存储路由器准备发往那条链路的分组。

   如果到达的分组需要传输到某条链路，但发现该链路正忙于传输其他分组，该到达分组必须在输出缓存中等待。这就引起了**排队时延**。

3. 分组丢失

   因为缓存空间的大小是有限的，一个到达的分组可能发现该缓存已被其他等待传输的分组完全充满了。在此情况下，将出现分组 **丢失（丢包）**（packet loss）,到达的分组或已经排队的分组之一将被丢弃。

   

![image-20230520135918488](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20230520135918488.png)



**转发表和路由选择协议**

路由器从一条通信链路得到分组，然后决定从另一条通信链路转发该分组。如何确定从哪条链路转出，不同的计算机网络以不同的方式完成分组转发的。以互联网为例：

在互联网中，每个端系统具有一个IP地址。当源主机要向目的端系统发送一个分组时，源在该分组的首部包含了目的地的IP地址。该地址具有一种等级结构。当一个分组到达网络中的路由器时，路由器检查该分组的目的地址的 一部分，并向一台相邻路由器转发该分组。每台路由器具有一个路由表 (forwarding table),用于将目的地址(或目的地址的一部分)映射成为输岀链路。当某分组到达一台路由器时，路由器检查该地址，并用这个目的地址搜索其转发表，以发现适当 的出链路。路由器则将分组导向该出链路。

路由表的产生：可以人工对路由器进行路由表配置，也可以根据一些路由选择协议，自动地设置路由表。







##### 电路交换

在电路交换网络中，在端系统间通信会话期间，预留了端系统间沿路径通信所需要的资源（缓存，链路传输速率）。在分组交换网络中，这些资源则不是预留的。在电话交换网络中，会话的报文按需使用这些资源，其后果可能是不得不等待（即排队）接入通信线路。

在发送方能够发送信息之前，该网络必须在发送方和 接收方之间建立一条连接。这是一个真实的连接，因为此时沿着发送方和接收方之间 路径上的交换机都将为该连接维护连接状态。

当连接建立时，它也在连接期间在该网络链路上预留了恒定的传输速率（表示为每条链路传输容量的一部分）。既然已经为该发送方-接收方连接预留了带宽, 则发送方能够以确保的恒定速率向接收方传送数据。







**分组交换和电路交换对比**







---





网络：多台计算机（结点）使用网线（链路）通过**集线器或者交换机**（结点）连接起来就组成了一个计算机**网络**，距离一般小于 100 米。集线器或者交换机负责在同一个网络中转发数据包。

互联网：多个网络通过**路由器**连接起来就组成了互联网。路由器负责在不同网络转发数据包。

路由器设备可以有广域网接口，以太网口用于接交换机。

整个互联网使用的是 TCP/IP 协议族，接入互联网的计算机之间就能相互通信。

不同网段有不同的路由器来选择不同的最佳路径

#### 互联网的三个发展阶段

![ image-20220329211539020](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329211539020.png)

![image-20220329211657178](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329211657178.png)

93 年开始，美国政府不再负责互联网的运营，交给商业公司运营（ISP）

![image-20220329212210653](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329212210653.png)



![image-20220329212304707](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329212304707.png)

![image-20220804001636063](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220804001636063.png)



#### 互联网组成

![image-20220329214716958](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329214716958.png)

![image-20220329220244727](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329220244727.png)

![image-20220329214938077](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329214938077.png)



![image-20220329215159520](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329215159520.png)

![image-20220329215255747](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329215255747.png)

一个计算机既可以同时是客户端也可以同时是服务器，只是该计算机上的某个应用程序是客户端还是服务端。

![image-20220329215552458](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329215552458.png)



![image-20220329220434057](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329220434057.png)

服务端软件特点：

![image-20220329220531766](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329220531766.png)

![image-20220329220621675](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329220621675.png)



![image-20220329220737527](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329220737527.png)

分组转发是网络核心部分最重要的功能。

互联网核心部分用到的技术：分组交换

互联网的核心部分的典型的数据交换方式：

- 电路交换（手机电话通信）

- 分组交换（计算机网络通信）

- 报文交换

电路交换：

![image-20220329222805118](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329222805118.png)

![image-20220329222813064](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329222813064.png)

![image-20220329222834860](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329222834860.png)

![image-20220329222935867](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329222935867.png)

![image-20220329223033584](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329223033584.png)

电路交换的特点：

![image-20220329223132951](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329223132951.png)

![image-20220329223331110](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329223331110.png)

电路交换不适合计算机之间的通信。



分组交换：

将传输的内容分段进行传输。

![image-20220329223649139](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329223649139.png)

![image-20220329223746480](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329223746480.png)

![image-20220329223817153](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329223817153.png)

![image-20220329223837834](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329223837834.png)

![image-20220329223910274](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329223910274.png)

![image-20220329223926717](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329223926717.png)

![image-20220804190512337](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220804190512337.png)

路由器（有存储转发功能）：

![image-20220329224257533](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329224257533.png)

![image-20220329224445299](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329224445299.png)

分组交换的优点：

![image-20220329224600372](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329224600372.png)

不足：

![image-20220329224739273](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329224739273.png)



报文交换：

要传递的内容就当作一个整体，不分段，发给下一个中转站并完全收到后，再由下一个中转站重复之前的操作发给下一个中转站，最后直到目的地。

三种交换的比较：

![image-20220329225218971](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329225218971.png)

![image-20220329225613058](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329225613058.png)



### 网络

网络：多台计算机使用集线器或者交换机（通用且可编程的硬件，这些设备可以传输许多不同类型的数据，文本，音频视频，邮件等。）连接起来就组成了一个网络。其中集线器和交换机这些物理设备负责在同一个网络中转发数据包。（接入层交换机和汇聚层交换机）

互连网：使用路由器将上面的各个网络进行连接就形成了互联网。其中路由器负责在不同网络中转发数据包（不一定使用 TCP/IP 协议，可以是自有协议）

因特网（全球最大互联网）：由众多的 ISP 的网络和且各个 ISP 之间的网络彼此互联组成的互联网络，ISP：互联网服务提供商。（采用 TCP/IP 协议族作为通信规则）

不管是企业还是个人都通过光纤或者电话线接入 ISP 的网络，ISP 为它们分配公网地址后才算接入了互联网。

局域网：通常是组织或者单位自己花钱购买网络设备，自行组件，带宽通常在 10M，100M，1000M，自己维护，覆盖范围小。

广域网：通常是花钱租用 ISP 的路线，花钱买带宽，覆盖距离长。

作用范围：

![image-20220329231817832](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329231817832.png)

使用者：

![image-20220329231825573](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329231825573.png)

ADSL 调制解调器：上传速度慢，下载速度快。电话线连接宽带猫，宽带猫再连接能自动拨号上网的无线路由器。家用的无线路由器是路由器，交换机和无线接入点（AP）三合一的设备。

![image-20211219191240887](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20211219191240887.png)

跨运营商访问服务器速度慢。

手机通过无线信号连接附近的一个基站，基站连接着光纤，信号或者数据通过铺设的光纤电路进行远距离传输或者接入互联网。

手机或者 ADSL 拨号上网都是通过电信网络去接入计算机网络。



### 计算机网络的性能指标

#### 速率

连接在计算机网络上的主机在**单条数字信道**上每秒传输数据这些数据占用的 bit 位数。每秒钟传递多少个 0 或者 1。

![image-20220329232220989](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329232220989.png)

数字信道：一台计算机中可以同时存在多个信道，一个信道是本机和远端服务器连接的一条线路。

#### 带宽

网卡或者网络设备的所能传送的最高速率。

![image-20220329232822875](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329232822875.png)

![image-20220329233207377](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329233207377.png)

带宽低的抗干扰性更强。

#### 吞吐量

![image-20220329234428776](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329234428776.png)

#### 时延

发送时延类比或者启动到出站的时间。数据在本机准备，到完全发出本机的网卡的耗时。

![image-20220329235227151](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329235227151.png)

![image-20220329235409857](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329235409857.png)

![image-20220329235547564](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329235547564.png)

![image-20220329235701246](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329235701246.png)

![image-20220329235642462](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220329235642462.png)

![image-20220804194854438](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220804194854438.png)

#### 时延带宽积

代表一段数据链路上能够承载的最大数据量（装满数据的上限）

![image-20220804200111457](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220804200111457.png)



#### 往返时间（RTT）Round-Trip-Time

从发送方发送数据开始到发送方收到接收方的响应的这个过程的用时。



#### 利用率

![image-20220804200549278](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220804200549278.png)

![image-20220804200531012](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220804200531012.png)

![image-20220804200555699](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220804200555699.png)

![image-20220804201640644](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220804201640644.png)



### DNS

互联网上的计算机可以通过多种方式被访问到，典型的方式有：

1. 主机名（hostname），比如www.google.com等，特点是便于人类记忆，因为主机名的长度由数量不固定的字母或者数字组成，所以路由器难处理，所以引入了IP地址
2. IP地址，IP地址由4个字节组成，有着严格的层次结构，如：121.7.106.83，其中的每个字节由一个点号隔开，表示时用十进制（0~255）表示，ip地址从左往右，能得到越来越具体的关于主机位于互联网中的位置信息。

为了协调人类的使用习惯和路由器的使用习惯，引入了一种能进行主机名到IP地址转换的目录服务——域名系统（Domain Name System）。

DNS的组成：

1. 一个由分层的DNS服务器实现的分布式系统
2. 一个使得主机能够查询分布式数据库的应用层协议

DNS服务器通常是运行BIND软件的UNIX机器。DNS协议是运行在UDP协议之上的，使用的端口号是53号。



## 计算机网络的体系结构

网络非常复杂，不是一个平面就能够解决的。它是一层一层解决的，每一层实现一组特定的功能，然后本层借助于下层所提供的服务，通过跟对等层的协议实体相互交换协议的报文来实现的功能。为了是向上层提供更好更优质的服务。那么一层摞一层，最后到了传输层，应用层则借助于传输层所提供的服务交换应用报文，实现各种各样的网络应用。

### OSI 七层参考模型

该模型将计算机之间的数据通信分为了七层（即：七 个步骤）

- 应用层：提供用户接口，发起网络通信的应用程序（客户端程序和服务器程序）
- 表示层：应用层数据的编码方式选择，加密和压缩
- 会话层：通信应用程序之间的连接的建立、维护和释放，可在应用程序之间建立多个连接，访问验证和会话管理

邮件协议（SMTP，POP3），文件传输协议（FTP），web 协议（HTTP），DNS 等。规定客户端能向服务器发送哪些请求（get,post,delete 等），服务器能向客户端发送哪些响应(200，301，302，404，500 等代表什么)，报文的格式。

- 传输层：通信的计算机之间建立连接，实现可靠或不可靠的数据通信，处理丢包重传，流量控制，避免拥塞，分段后的数据的缓存，编号，排序。 （数据确认包）

- 网络层：路由器通过数据包目标 IP，根据自身路由表为数据包在不同的网络中选择路径，路由表可人工配置（静态路由）和动态生成（动态路由）

- 数据链路层：不同网络中，发送数据的机制不同，该层将数据包封装成能在不同网络中传输的数据帧，处理差错检查，出错就对其该数据帧

- 物理层：规定通信的物理设备的接口标准，电压标准，采用不同技术策略实现数据的更快传输

客户端会话层和服务器端会话层建立连接（面向用户）；客户端传输层和服务端传输层建立连接。

不同的网络：

- 交换机或集线器连组建的网络是称为以太网，以太网使用载波监听多路访问协议（CSMA/CD）
- 路由器和路由器之间的网络是点到点的链路，可以使用 PPP 协议或者帧中继站（Frame Relay）协议

以太网中的数据帧用的是目标 MAC 地址和源 MAC 地址，而点到点链路上的帧则不用添加 MAC 地址。

计算机网络通信原理和过程。

计算机各层通信协议

数据包结构和每层对数据包的封装

网络层畅通的条件

传输层协议和应用层协议的关系

各种应用层协议数据包格式

计算机网路主要讲的就是协议。

协议：

- 协议双方
- 协议目的
- 协议内容

网络协议的三要素：

- 语法：数据和控制信息的结构或者格式
- 语义：需要发出何种控制信息，完成何种动作以及做出何种反应
- 同步：事件实现顺序的详细说明

例如计算机网络中的 ip 协议：（一共 32 个字节）

![image-20210729223711865](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20210729223711865.png)

数据+传输层首部+网络层首部+链路层首部

传输层首部：传输层协议需要填写的内容（接收端查看传输层内容决定如何处理）

网络层首部：就是上图的 ip 协议（路由器查看网络层首部，决定怎么走链路）

链路层首部：链路层需要的内容（供交换机使用负责转发）

计算机通信时，是计算机上的应用程序在通信。而程序通常分为两个部分，客户端程序和服务端程序。 对等实体

通常客户端主动访问服务器，而服务器被动接受访问。

客户端能向服务器发出哪些请求（命令），请求的发出顺序，发送请求的报文有哪些字段，这些字段分别代表什么意思；而服务器接收到客户端的请求后能向客户端返回什么响应，什么情况下发送什么响应，发送的响应报文有哪些字段，这些字段的意思等等，都是实现协议规定好的。

比如，对于文件服务器，允许别人上传或者下载文件，这时用的就是 FTP 协议。这个协议规定了一系列的功能，允许用户删除服务器中的文件，重命名文件，上传和下载文件。这些都对应着不同的请求方式。

再比如，对于网站服务器，对于访问网站的应用，就不允许用户进行文件增删改查等文件操作，所以这时采用的通信协议就没有提供这些方法。而访问网站采用是 http、https 协议。

客户端能向服务器发送的请求是由程序的功能而定的。

高级防火墙可以控制应用层协议的方法。能看到应用层协议的防火墙，看不到网络层，链路层的情况。

![image-20210729235308434](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20210729235308434.png)

为了实现应用程序的功能，需要定义通信标准——应用层协议。

比如（应用层协议）：

- 域名解析，客户端找 DNS 服务器进行解析服务，采用 DNS 协议。 （域名解析协议）
- 访问网站，采用 http 协议（超文本传输协议）HTTPS（安全超文本传输协议）
- 发邮件，采用 SMTP 协议（简单邮件传输协议）
- 文件下载与上传，采用 FTP 协议（文件传输协议）
- 计算机自动请求 ip 地址，采用 DHCP（动态主机配置协议）
- 远程登录，采用 telnet 协议，用于远程配置网络设备和 linux 系统

HTTP 协议（Hyper Text Transfer Protocol）超文本传输协议：是互联网中服务器传输超文本到本地浏览器的一种传送协议。 HTTP 是一个基于 TCP/IP 通信协议来传递数据（HTML 文件，图片，视频等）的**应用层协议**。

HTTP 协议工作在客户端-服务器端架构之上，浏览器作为 http 客户端通过 URL 向 HTTP 服务器端即 web 服务器发送请求。web 服务器发送根据接收到的请求，向客户端发送响应信息。

![image-20210730001041240](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20210730001041240.png)

![image-20210730001115115](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20210730001115115.png)

![image-20210730001137749](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20210730001137749.png)

![image-20210730001352759](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20210730001352759.png)

![image-20210730001450199](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20210730001450199.png)

![image-20210730001649674](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20210730001649674.png)

语法：是数据和控制信息的结构和格式；

语义：是控制信息的含义；

同步：规定了信息交流的次序，比如传输层使用 TCP 协议进行可靠传输前需要先建立 TCP 链接，然后再传输数据，传输结束后，要释放链接。应用协议通信，对所执行的命令也有顺序要求，比如使用 POP3 协议收邮件，必须要先验证邮箱账号和密码，再接受邮件。

应用层通信协议的下层：TCP/IP 协议

![image-20210730002119040](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20210730002119040.png)

**封装与解封**

![image-20210730002223408](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20210730002223408.png)

网络是不可靠的，在传输过程中可能丢包。数据在发送的是一段一段的形式发送的。发时可能丢包（如：路由器处理不过来，导致丢包。）客户端在接收到数据后发现不完整，那服务端还需要通过特定的机制重新传一份。同时数据包在发送时，可能走的是不同的链路路线导致乱序到达客户端或者服务端。在接收端也需要对此进行重新排序。 这些操作都是 TCP 协议来管控的。

在两端计算机上实现可靠传输的协议是 TCP 传输层协议。负责可靠传输

把需要传输的文件分段传输，需要加上发出地地址和接收地地址（IP 地址），有 IP 网络层协议管控。（数据包），数据帧每过一个路由器，TTL 减一。只负责传数据包到目的地，丢不丢包，到达顺序乱不乱它不管。

以上都是在计算机内部实现的。

数据帧在链路层中的各个路由之间传输时，会不断的拆封和封装**链路层首部**。

网卡封装 mac 地址，寻找下一跳，这由数据链路层协议来管控。（数据帧）（网卡做的事）（**以太网 首部**）

多方协议（多方参与）。

**分层设计的好处：**

![image-20210730004827989](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20210730004827989.png)

TCP/IP 协议族的体系结构

![image-20210730004948866](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20210730004948866.png)

PPP 协议：Point to Point

OSI 七层参考模型

![image-20210730005706614](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20210730005706614.png)

五层协议对应的数据单元：

应用层： 传输数据单元（PDU）

传输层：数据段（报文）

网络层：数据包

数据链路层：数据帧

物理层：比特 数据帧 + 帧头+帧尾

![image-20220804221621559](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220804221621559.png)

## 第一章 计算机网络与协议

本章是对计算机网络的初步了解。后面的课程是根据计算机网络的分层来进行一层层的讲解。

- 网络，互联网和因特网
- 企业级网络结构（局域网和广域网）
- OSI（开放系统互连）七层参考模型
- 计算机使用 TCP/IP 协议通信过程，数据封装和解封过程
- 集线器，交换机和路由器及其所在分层
- 计算机网络的性能指标

网络：多台计算机使用**集线器**或者**交换机**（不以集线器或者交换机的台数而定）连接起来就形成了一个网络。(局域网)

交换机链接交换机都是在一个网段的，都属于一个网络。

集线器或者交换机负责在 **同一个** 网络中发送数据包。

互联网：上面说到的网络通过至少一个**路由器**进行连接后的互联网络。

路由器：负责在不同网络中转发数据。

互联网服务提供商（ISP）向用户提供互联网接入业务，信息业务等。

中国三大 ISP：电信，联通和移动。

**internet 接入服务**

Internet（因特网）是全球最大的互联网。在中国主要有三家互联网服务提供商（ISP：电信，移动，联通），它们给用户提供互联网的接入业务等。各个组织的网络和个人用户的网络都会接入 ISP 的网络以成为互联网络的一部分。

个人用户通过电脑通过 电话线+ADSL 调制解调器 连接到中心局，中心局接入 ISP。

因为个人用户的需求绝大部分是上网浏览咨询和视频等，而 ADSL 调制解调器就是专门为此设计的，特点是下载速度快而上传速度慢。

企业可以直接从 ISP 那里拉去光纤直接接入 IPS 的网络，并分配公网 IP 地址。

当跨运营商访问资源时会变慢，因为光纤的最大流量是有限的而使用者很多。

ISP 利用现有的电话网络为用户提供 Internet 接入服务，但是需要使用 ADSL 调制解调器（model）链接电话线和和计算机。 对于一般用户，上网主要是浏览网页，下载视频等获取信息为主，而 ADSL 就是主要针对之类应用而设计的，即下载速度快，上传速度慢。

大型企业的网络需要接入 Internet，则可以直接使用光纤接入。如果为企业的服务器分配了公网地址，则企业的网络就成为了 internet 中的一部分。如果企业为了给网名提供服务，但是自己又没有机房，则可以将服务器托管在网通和电信的机房中。跨运营商访问的网速会慢。某些公司为了解决跨运营商访问慢的问题，可以把服务器托管到双向服务器中。

局域网通常是组织自己花钱购买设备（交换机，集线器）等组件，带宽固定为 10M，100M 或者 1000M，自行维护，覆盖范围小。 广域网常是花钱租用 ISP 的路线和带宽，用于长距离通信。

家庭互联网：

电话线连接宽带猫（Modem），宽带猫连接拨号上网的无线路由器（自动拨号上网）。

家用的无限路由器是路由器，交换机和无限接入点（AP，也可以看作交换机）组合而成。在机体内部，路由器和交换机的 LAN 接口连接，AP 和交换机的 LAN 连接口连接。路由器的 WAN 口和宽带猫的连接，无线路由器拨号后，ISP 会自动的分配一个公网地址。路由器和交换机的 LAN 接口连接的默认地址是 192.168.0.1（也可以自行设置）。

网络：多台计算机通过集线器或者交换机连接就组成了一个网络。集线器或者交换机负责在 **同一个** 网络中发送数据包。

互联网：如果存在多个上面所述的网络，然后将他们之间通过路由器连接起来，则形成互联网。 路由器负责在 **不同的网络**转发数据包。

注意：是否是互联网的关键在于是否连接了多个网段。

#### OSI 参考模型

该模型将计算机通信过程分为 7 层（即 7 个步骤），并规定了每一步所要实现的功能。互联网设备厂商和软件开发者参考该模型设计自己的硬件和软件，以实现不同厂商和软件之间的正常通信。

七层分别是：每一层负责一项具体的工作，然后把数据传递给下一层。每一层为上一层提供服务， 每层实现特的功能 。每次的变化不影响其他层的更改。

- 应用层提供用户接口，特指能够发起网络通信的应用程序。
- 表示层数据的编码方式（ascii 编码，Unicode 编码，二进制编码，是否压缩加密等），发送端和接受端必须以相同的编码方式编码和解码，否则就会产生乱码。
- 会话层通信的应用程序之间建立，维护和释放面向用户的链接。通信的应用程序之间建立会话，需要传输层建立一个或者多个链接。
- 传输层负责在通信的两个计算机之间建立连接，实现可靠的或者不可靠的数据通信，能够实现发送端和接收端的丢包重传，流量控制，拥塞避免。（TCP）
- 网络层路由器查看数据包的目标 IP 地址，根据路由表为数据包选择传输路径。路由表中的条目可以人工添加（静态路由）也可以动态生成（动态路由）。
- 数据链路层不同的网络类型发送数据的机制不同，数据链路层就是将数据包封装成能够在不同网络中传输的数据帧。能够进行差错检查，但是不纠正错误，一旦检测出错误则丢掉该数据帧。
- 物理层规定了网络设备的接口标准，电压标准，尽可能的通过频分复用，时分复用技术在通信链路上更快的传输数据。

例子：浏览器访问服务端网页 ![image-20210730223106578](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20210730223106578.png)

1. 应用层发起数据通信请求，web 服务和浏览器工作在应用 层。

2. 网页中的文字和内容要进行传输，必须转换成数字信息，这就需要对要传输的文字进行

   编码，这是表示层要解决的问题。这个转换过程需要有字符集。信息通过字符集可以转换成数据，数据通过字符集可以转换成信息。

   有些文件内容不是字符，而是图片文件和程序文件，这些文件就不需要字符集进行编码可以直接以二进制的方式传输。有的厄用程序需要考虑数据传轮的安全性，比如 QQ 聊天的内容，就需要在传轮之荀加密， 对方 QQ 收到之后再解密，这也属于表示层的功能。

   有的应用程序在传输数据之前为了节省带宽，需要先进行压缩再传输，比如 QQ 视频聊天，摄像头捕荻的视频经过压缩后传输给对方，对方收到后解压看到视频，这样就减少了视频聊天占用的网络带宽，应用程序实现的这个功能也属于表示层功能。

3. 计算机 的浏览器访问网站， 需要 浏览器和 Web 服务器 的进程建立会话 建立维持会话的功能称为 话层 它提供包括访间验证和 话管理在内的建 和维护应用之间通信的机制。

4. 网页需要通过网络传输到计算机 A,传输之前要进行拆分、装箱，放入缓存，分段编号，依次发送给计算机 A, 计算机将收到的分段放入缓存，这个过程由传输层完成，传输 能够实现可 传输和流量控制。

5. 客户端收到发送过来的分段后，将分段放到缓存，如图 1-13 所示，若收到了编 号连续的笫 1 、第 2 、第 3 个数据段，就会给网站发送一个确认数据包，告诉服务端发送笫 4 个数据段，这时服务器就可以将缓存中的笫 1、笫 2 、笫 3 个数据段删除，接着发送后面的数据段，将网页后面的内容放到缓存准备发送。

   如果网站连续发送了第 1 、第 2、第 3 和第 4 个数据段，但传输过中丢了笫 3 个数据段，计算机收到了第 1 和笫 2 和第 4 个数据段。客户端会给服务器发送一个确认数据包 ，告诉服务器发送笫 3 个数据段以后的数据段。可见网络虽然不可靠 但传输层能够确保发送方和接收方能够可靠地传输数据。传输层也能实现发送端和接收端的流量控制功能，比如发送端发送得快 接收端缓存满了，就会通知发送端减慢发送速度，或停止发送。

6. 从图 1-13 中可以看到路由器是专门负责在不同网络转发数据包的，为数据包选择转发路径。为数据包选择路径的功能由网络层完成，因此路由器工作在网络层。

7. 数据链路层就是将数据包封装成能够在不同链路传输的帧 数据包在传递过程中要经过不同网络 ，比如 集线器 或交换 组建的网络就是以太网 ，以 太网使用载波 侦听 路访问协议 CCSMA/CD) 路由器和路由器 间的连接是点到点的链路，点到点链路可以使用 PPP 协议或者帧中继（Frame Relay ）协议 。数据包要想在不同 型的链路传输需要封装成不同的帧格式 比如以太网 的帧， 加上目标 MAC 地址和源 MAC 地址，而点到点链路上的 帧就不用 MAC 地址。

8. 物理 定了

   络设备 接口标准 、电压标准 要是不定义这些标准，各个厂家生产的网络设备就不能接到一起，更不可能相互兼容 物理 也包括通信技术，那 门研究通信的人就要想办 让物理线路（铜线或光纤）通过频分 用技术或时分 用技术或编码技术 快地传输数据。

![image-20210730224930808](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20210730224930808.png)

程序员开发网络应用 序，他们负责解决应用层、表示层和会话层的问题，他们只关心应用程序之间如何通信 ，通信是否需要加密和压缩，避免出现乱码。

网络工程师负责配置网络中的路由器为数据包选选择转发路径。网络工程师还需要配置交换机，交换机是数据链路层设备。所以网络工程师也负责 OSI 参考模型的数据链路层。他们精通路由器和交换机的配置，那些考 思科认证工程 CCNA 和 CCNP 及考 了华为 络工程师认证的人 可以负责维护企业网络。

![image-20210730225744716](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20210730225744716.png)

#### 计算机网络排错

排除网络故障，建议从 OSI 参考模型的底层向高层逐层检查。网络安全方面的排查也可以参考 OSI 模型，分为物理层安全，数据链路层安全，网络层安全，传输层安全和应用层安全。

表示层负责将信息进行正确的编码和解码，加密和解密，压缩和解压。程序开发人员在开发程序 要正确指定服务器和 客户端使用字符集，避免 产生乱码。

木马程序通常要和远程计算机进行通信，只要通信就会在传输层建立连接 ，我们可以通过查看是否有可疑连接 ，来进步判断是否中了木马。

在自己的电脑上查看传输层建立的连接，以管理员的身份打开命令提示符。输入命令行指令： netstat -nb 该指令会输出到 Internet 的连接。要想知道 tstat 令全部可用的参数，可以输入 netstat /?"将会列 出全部参数 参数的作用。

在查看到可疑的进程名称后，打开任务管理器，在命令行栏信息中找到进程所在的文件路径，然后删除即可。

自底向上排错

- 检测网络连接是否正常（网线是否插好等），物理层 ![image-20210731201733890](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20210731201733890.png)

- cmd 窗口下 输入 ipconfig /all 查看 IP 地址，子网掩码和网关以及 DNS 设置是否正确。 IP 地址正确，ping 一下网关测试是否能和本网段的计算机通信，然后再 ping 英特网公网地址（如 ping 百度官网），检测 internet 是否畅通 网络层。 8.8.8.8 114.114.114.114
- Internet 通常但是还是打不开网页，就继续检测是否能正确解析域名。如果你的计算机配置了一个错误的 DNS，那计算机将不能解析域名，也就无法打开网站。
- 如果域名解析没有问题，但还是不能访问，也许是沿途的路由器不允许访问网站的流量通过

![image-20210731202613606](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20210731202613606.png)

当前互联网通信使用的是 TCP/IP 协议栈，该协议没有严格按照 OSI 参考模型的分层来设计，而是进行了合并，把计算机通信分为了 4 层。

![image-20210731093042078](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20210731093042078.png)

协议栈是指网络中各层协议的总和。

协议的三要素：

- 语法：数据和控制信息的结构和格式
- 语义：控制信息的含义
- 同步：信息交流的次序（比如传输层使用 TCP 协议进行可靠转出前，需要先建立 YTCP 连接，在传输数据，传输结束后要释放连接）

#### TCP/IP 通信过程

web 服务器的 ip，网卡的 MAC 地址

浏览器的 ip，网卡的 MAC 地址

路由器的接口相当于网卡也有 MAC 地址和 IP 地址

![image-20210731210540081](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20210731210540081.png)

**应用层**：对等实体是浏览器和 web 服务器。浏览器和 Web 务器之间通 使用应用 http )。该协议定义了访问网站有哪些方法以及网站响应报有哪些状态。

**传输层**：网页数据在传输之前放到缓存，将数据分段后加上**传输层首部**，传输层首部的格式以及每个字段是为了实现传输 层功能 ，比如可靠传输 、流量控制 、拥塞避免。传输层首部一个重要的功能是给这些数据编号。浏览器的传输层将收到的数据放到缓存，浏览器能够看懂传输层添加的首部，因此**web 服务器的传输层和浏览器的传输层是对等实体**，传输层首部的各个字段以及各个字段数值代表的含义就是传输层使用的协议。

传输层首部：

![image-20220330200958869](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220330200958869.png)

![image-20210731210636629](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20210731210636629.png)

![image-20220330194606256](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220330194606256.png)

![image-20220330195318929](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220330195318929.png)

**网络层**：数据段想通过网络发送给浏览器，必须给数据段添加源 IP 地址和目标 IP 地址以及网络层的控制信息，也就是网络层首部。网络层首部的格式和每个 段是为了实现网络层功能 ，以便网络中的路由器依据网络层首部为数据包选择路径。因此浏览器的网络层 ，以及网络中沿途经过的路由器必须能够理解 Web 服务器在网络层添加首部的格式以及每个字段所代表的含义，因此 web 服务器的网络层、沿途经过的路由器以及浏览器的网络层是对等实体。它们的共同语言就是网络层首部，网络层首部就是网络层使用的协议。加了网络层首部的数据段就称为数据包 ackets) ，为 了表示方 便，图中只使用源 IP 地址和 目标 IP 地址代表网络层首部 。

![image-20220330201127489](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220330201127489.png)

**数据链路层**：数据包想要在网络中传递，就要针对不同的网段进行不同的封装，也就是封装成不同格式的帧。

使用集线器组件的网络就是以太网，连接在集线器的计算机使用 CSMA/CD 协议进行通信，连接在集线器上的设备都有物理地址（mac 地址），计算机的网卡和路由器的接口也都有 MAC 地址。数据包从服务器发送到浏览器，需要先转给路由器 RouterA。在数据链路层添加数据链路层首部，其中包括源 AC 地址 MA、目 MA 地址 MB ，加了数据链路层首部的数据包 ，称之为帧 （Frame），服务器网卡和路由器 RouterA 以太网接口是数据链路层的对等实体。

数据包在路由器 RouterA 依次转发到 B，C，D 的链路是点到点链路。这样的链路上没有其他设备，发送数据帧不需要添加物理层地址，而是使用 PPP 协议，因此数据包从 C 到 D 需要重新封装成 PPP 协议的帧格式。使用 十六进制 FF 代表地址，其实该地址形同虚设，既不代表源地址也不代表目标地址，接口 C 和 D 是数据链路层的对等实体。

从 RouterC 将数据包发送到客户端浏览器的网卡，需要将数据包封装成以太网的帧格式，需要添加目标 MAC 地址 MF 和源 MAC 地址，路由器 RouterC 的以太网接口和浏览器网卡是数据链路层的对等实体。

以太网首部：

![image-20220330201253769](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220330201253769.png)

数据包在传输过程中是不变的，但是在数据链路层会根据不同的网络封装成不同的数据帧格式。

注释：物理地址决定下一跳给谁，而 ip 地址决定数据包最终目标地址。如果全球的计算机都使用集线器或者交换机连接，就可以使用 MAC 地址进行通信了。

**物理层**：服务器将数据包封装成帧后，网卡将数字信号变为电信号传送到网络，称为比特。服务器网卡和 RouterA 的以太网接口同时也是物理层对等实体，电压标准和接口标准必须一致。

![image-20210801101850760](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20210801101850760.png)

![image-20220330201430903](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220330201430903.png)

### 网路排错

![image-20220330213315174](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220330213315174.png)

![image-20220330214835116](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220330214835116.png)

![image-20220330214140591](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220330214140591.png)

![image-20220330214127458](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220330214127458.png)

ping 域名查看域名解析是否正常

![image-20220330214215049](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220330214215049.png)

telnet 域名下的具体端口

`telnet www.baidu.com 80`

![image-20220330214423560](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220330214423560.png)

telnet 无法使用问题：

![image-20220330214549273](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220330214549273.png)

开启 telnet

![image-20220330214631980](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220330214631980.png)

比如自己的计算机上网是通过代理服务器上网的。如果代理服务器不存在，则访问不了了。

代理服务器：一般本机访问网站是直接访问目标服务器的。但是如果我选择访问一个其他服务器，让其他服务器去访问好网站后返回给本机。

### 网络安全

![image-20220330220808276](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220330220808276.png)

wf.msc：设置 windows 本机防火墙，控制进入的流量。

![image-20220330220347060](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220330220347060.png)



![image-20220330220903339](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220330220903339.png)

![image-20220330221043775](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220330221043775.png)

![image-20220330221147513](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220330221147513.png)

![image-20220330221252286](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220330221252286.png)

![image-20220330221630678](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220330221630678.png)

![image-20220330221704380](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220330221704380.png)

![image-20220330221727276](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220330221727276.png)

![image-20220330222331408](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220330222331408.png)

![image-20220330222421785](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220330222421785.png)

IP 层通过协议号区分上层采用的是 TCP 还是 UDP 协议，TCP 协议采用端口号来区分上层是 http 协议还是 ftp 等其他协议。



## 第二章——物理层

### 基本概念

物理层解决如何在连接的各种计算机的传输媒体（不是指代具体的传输媒体，比如不是指代光纤，双绞线或者无线）上传输数据比特流。

![image-20220805220307893](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220805220307893.png)

计算机将要传输的数据变为电信号或者光信号或者无线信号进行传输，物理层就是讲述如何在各种介质中更快的传输数字信号或者模拟信号。

#### 典型得数据通信模型

![image-20220805220503187](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220805220503187.png)

![image-20220805221128940](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220805221128940.png)

## 第三章——数据链路层

### 基本概念

数据链路层使用的信道主要有两种：

- 点对点信道
- 广播信道

在不同的信道上通信使用的是不同的协议。

### 解决问题

## 第八章——传输层

传输层是网络层和应用层之间的一层，实现计算机之间通信的 **可靠** 传输。

![image-20210821110343737](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20210821110343737.png)

TCP 协议：

应用层协议定义了客户端能想服务器发起什么样的请求，以及服务器能向客户端发出什么样的响应和操作以及各种请求的数据包的格式。

客户端向服务器发送一个请求，这个请求要从客户端传到服务器，文件从服务器传到客户端，还需要计算机有一个传输层，以负责可靠传输。在传输的时候先分段编号放到缓存中，一段一段的传递。每一段在网络层加上网络层的首部（源 IP 和目标 IP），封装为数据包，数据包根据不同的数据链路封装为不同数据帧，路由器帮助实现数据包的路由和转化。

网络层负责将数据包传输到目的地，传输控制可靠传输，如果网络层存在丢包的情况，传输层能知道，并再次补发丢失的数据包。并且传输层感知并发现网络堵塞，还可以降低发包速度。 并且传输层还能更具客户端的接收能力调整发包速度。

通信完成后，两端的传输层还需要释放连接。通信前要建立连接。通信过程中要进行流量控制和可靠传输。

UDP 协议：

它没有流量控制功能和丢包查错的能力。

#### TCP 和 UDP 协议的应用场景

网络中的计算机通信无外乎有以下两种情况：

1. 要发送的内容多，需要将发送的内容分成多个数据包发送。 分段，编号，流量控制，避免拥塞，可靠传输。客户端和服务器需要建立 TCP 连接，通信结束需要释放连接。
2. 要发送的内容少，一个数据包就能发送全部内容。 比如实时语音，视频直播，不需要分段，流量控制，完整传输。 有应用层进行判断，不需要建立连接节省服务器资源。

针对这两种情况，在传输层有两个协议：

TCP（Transmission Control Protocol 即传输控制协议）

UDP（User Datagram Protocol 即用户数据报协议）

**传输层协议和应用层协议之间的关系**

传输层协议加一个端口号来标识一个应用层协议，展示了传 输层协议和应用层协议之间的关系。

![image-20210821121221389](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20210821121221389.png)

**服务和端口号的关系**

在一台服务器中可能会提供多种服务，比如 web 服务，ftp 服务 SMTP 服务。每个服务都会启用一个传输层协议加端口号来监听客户端请求。

一个来自客户端的请求通过 IP 传到服务器后，具体要使用哪像服务，就是通过端口号来确定的。客户端通过 IP 地址定位服务器，通过协议和端口号定位服务 器上的服务。

Windows 和 Linux 操作系统有些服务为本地计算机提供服务，有些服务为网络中的计算机提供服务。为网络中计算机提供服务的服务，一旦启动就会使用 TCP 或 UDP 的某个端口侦听客户端的请求。

客户端软件可以同时访问多个服务器，客户端会为每个出去 的流量分配一个唯一的源端口。服务器上的服务侦听的端口不能冲突，否则将会造成服务启 动失败。

![image-20210821134715461](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20210821134715461.png)

![image-20210821134802926](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20210821134802926.png)

应用层协议也可以不使用默认端口和客户端通信。 如果不适用默认端口通信，客户度需要指明使用的端口。

**端口号与网络安全**

客户端和服务器之间的通信使用应用层协议，应用层协议使用传输层 协议+端口标识，如果在网络设备封掉 TCP 或 UDP 的某个端口，就不能 访问其对应的服务，就可以实现网络安全。设置服务器网络安全，只开放必要的端口。 在 Windows 上可以通过设置 TCP/IP 筛选和 Windows 防火墙来实现。

![image-20210821135037357](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20210821135037357.png)

![image-20210821135104690](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20210821135104690.png)

netstate -an:查看本地监听的端口

netstat -n：查看建立的 TCP 连接

netstat -anb:查看监听端口及其应用程序

mstsc:启动远程连接桌面功能，输入对方电脑的 IP 地址。对方地址必须开启允许远程控制。

![image-20210821140110635](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20210821140110635.png)

telnet 域名 | IP 端口: 测试某个服务器上的对应端口能否访问对应的服务。不要认为对方服务器启动并监听了某个端口，客户端就能去请求访问成功，因为有可能有防火墙导致访问不成功。

![image-20210821141106687](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20210821141106687.png)

除了使用 telnet 命令，还可以使用端口扫描工具，它可以指定一个端口号范围，去查看远端计算机开了哪些端口号，以初步判断该服务器中开启了哪些服务。黑客在入侵时往往就是先扫描端口号，获取服务器信息，饭后通过端口大致判断开启的是哪些服务，web 服务的话，看是什么软件搭建的 web 服务，看有无漏洞，再攻击。

#### UDP 传输层首部和特点

特点：

- UDP 是无连接的，即发送数据之前不需要建立连接（当然发送数据结束时也 没有连接可释放），因此减少了开销和发送数据之前的时延。
- UDP 使用尽最大努力交付，即不保证可靠交付，因此主机不需要维持复杂的 连接状态表（这里面有许多参数），通信的两端不用保持连接，因此节省系统资源。
- UDP 是面向报文的，发送方的 UDP 对应用程序交下来的报文，在添加首部后 就向下交付给网络层。UDP 对应用层交下来的报文，既不合并，也不拆分，而是 保留这些报文的边界。

![image-20210821153500232](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20210821153500232.png)

#### TCP 传输层首部和特点

特点：

- TCP 是面向连接的传输层协议。这就是说，应用程序在使用 TCP 协议之前，必须先建 立 TCP 连接。在传送数据完毕后，必须释放已经建立的 TCP 连接。
- 每一条 TCP 连接只能有两个端点（endpoint），每一条 TCP 连接只能是点对点的（一 对一）
- TCP 提供可靠交付的服务。也就是说，通过 TCP 连接传送的数据，无差错、不丢失、 不重复、且按序发送。
- TCP 提供全双工通信。TCP 允许通信双方的应用进程在任何时候都能发送数据。TCP 连接的两端都设有发送缓存和接收缓存，用来临时存放双向通信的数据。在发送时，应 用程序把数据传送给 TCP 的缓存后，就可以做自己的事，而 TCP 在合适的时候把数据发送 出去。在接收时，TCP 把收到的数据放入缓存，上层的应用进程在合适的时候读取缓存中 的数据。
- 面向字节流。TCP 中的“流”（steam）指的是流入到进程或从进程流出的字节序列。

## 网络层

### IP 地址和子网划分

预备知识：

![image-20220330223741208](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220330223741208.png)

![image-20220330224021884](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220330224021884.png)

规律：

![image-20220330231709568](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220330231709568.png)

给你一个数，请确定最后的 1 位，2 位，3 位，4 位分别是多少？（面试）

例子：176 / 16 余 3 则： 0011 ； 817 / 8 余 1 则：001。

十六进制

网卡的 mac 地址就是用 16 进制表示（48 位 16 进制）。

一个十六进制的数需要用 4 位二进制表示。

### IP 地址

MAC 地址是数据链路层的地址；IP 地址是网络层的地址。

MAC 地址的作用：接到交换机或者集线器上的计算机的网卡或者路由的以太网接口都有 mac 地址，路由器的以太网接口也有 mac 地址。

![image-20220330233319044](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220330233319044.png)

通过交换机连接的计算机组成一个以太网。

上图有三个网段（三个以太网）。为了将数据包从 A 发给路由器 1，则需要彼此的 mac 地址。交换机读取数据链路层地址，进行数据包的转发。 路由器 1 在接受到数据帧后去掉数据链路层地址，读取目标 IP 和源 IP 地址，查询路由表，寻找下一跳并封装上新的数据帧发出，依次到目标到达目标计算机 F 的 MAC 地址。

什么情况下可以不用 IP 地址而直接用 mac 地址？

如果全球联网都用交换机连接，则可以用 mac 地址。但是这是不可能的，因为一台交换机就得记忆大量的 mac 地址，基本不可能。再者，在一个以太网中，一个计算机要想得到另一台计算机的 mac 地址是需要 ARP 广播请求的，导致发一个广播所有的计算机都能收到，将是一个非常庞大的流量。所以不同网段之间必须用路由器隔开，将 ARP 广播控制在一个有限范围的计算中。

有了路由器就需要网络层地址，让路由器基于网络层地址进行转发，而不是基于 mac 地址进行转发。

![image-20220331000329538](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220331000329538.png)

**IP 地址的组成**

互联网上的计算机相互通信 IP 地址需要进行统一规划，且不能重叠，必须具有唯一性。规划时，IP 地址又分为网络部分和主机部分（类似电话号码的区号）。

IP 地址由 32 位二进制组成，在计算机中查看 IP 地址时是 10 进制表示的，一共 4 部分，每部分由 8 个二进制表示。最大就是 255.255.255.255。

![image-20220330235745583](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220330235745583.png)

路由器中不同接口配置的网段必须不同。路由器接口的地址通常情况下是使用该网段下的第一个或者最后一个地址（习惯）。

**IP 地址的格式**

![image-20220331000441975](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220331000441975.png)

**子网掩码的作用（地址掩码，网络掩码）**

![image-20220331000636786](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220331000636786.png)

子网掩码能让计算机算出自己处于哪个网段。 因为我们的计算机想要和网络中的其他计算机进行通信，必须首先判断目标地址是否和自己在一个网段，因为在一个网段和不在一个网段的通信过程是不一样的。在一个网段发送 arp 广播直接解析目标计算的 mac 地址，然后封装数据帧后由交换机直接将数据发送给目标计算机。不在一个网段，则发送 arp 广播，解析网关的 mac 地址，封装为数据帧，由交换机发送给路由器，由路由器去转发。

配错子网掩码会造成通信故障。

![image-20220331131549125](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220331131549125.png)

![image-20220331131715563](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220331131715563.png)

### **IP 地址的分类**

![image-20220331135608322](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220331135608322.png)

![image-20220331135752240](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220331135752240.png)

![image-20220331135906041](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220331135906041.png)

![image-20220331135947166](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220331135947166.png)

![image-20220331140143715](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220331140143715.png)

保留的 IP 地址：

![image-20220331140249068](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220331140249068.png)

### 保留的 IP 地址

由特殊用途的 IP 地址。

![image-20220331193751264](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220331193751264.png)

主机位是全为 1 代表本网络中的所有主机，用于计算发送广播包。

169.254.0.0，联网时就会向网络中的 DHCP 服务器发送请求，请求或者一个合法的 IP 地址，如果 DHCP 服务器没有为设备分配有效的 IP 地址 ，windows 系统会自动为本机默认自动设置一个 IP 地址（169.254.0.0 网段下的一个 ip 地址，自动私有地址，临时地址）同时也会尝试继续请求 DHCP 服务器，以尝试获取合法 IP 地址，一旦 DHCP 服务器分配了合法的 IP 地址，则该计算机就能联网了 。

### 公网地址与私网地址

![image-20220331213403312](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220331213403312.png)

私有 IP 地址：

![image-20220331213600504](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220331213600504.png)

![image-20220331214325993](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20220331214325993.png)

子网掩码能用到二进制。









# 第一章

互联网是一个非常复杂的系统，连接了数亿计的计算机、通信链路、交换机和路由器，同时要有一批和互联网连接的物品。面对着的有众多不同组成的系统，有一些指导原则和结构能帮助学习者理解互联网，理解互联网的原则和实践。

第一章的目标：

1. 宏观概述计算机网络和互联网
2. 本书的内容框架
3. 背景知识
4. 计算机网络构件以及他们在整个网络中的位置



具体安排：

1. 介绍基本术语和概念
2. 构成网络的基本硬件和软件组件
3. 网络边缘中的端系统和端系统上的网络应用
4. 网络核心的链路和交换机
5. 接入网和物理媒介
6. 网络如何连接起来的
7. 计算机网络中的数据传输的时延、丢包和吞吐量等
8. 计算机网络的体系结构原则：协议分层和服务模型
9. 网络攻击和网络安全
10. 计算机网络的历史



## 什么是互联网

本书讲述的计算机网络对象是——公共互联网。

回答什么是互联网的两个角度：

1. 从描述互联网的具体构成角度回答，即构成互联网的基本硬件和软件组件是什么。
2. 从互联网为什么而存在的角度回答，即为分布式应用提供服务的联网基础设施。



### 互联网的具体构成角度

互联网是一个连接了全球数十亿台计算设备的计算机网络。

典型的计算设备：

1. 桌面PC
2. Linux工作站
3. 服务器
4. 智能手机
5. 平板
6. 其他各种物联网物品

所有这些计算设备都可以统称为——**主机(host)**或者**端系统(end system)**。



端系统和分组交换机之间使用 **通信链路** 连接。

典型的通信链路的物理媒介有：

- 同轴电缆
- 铜线
- 光纤
- 无线电频谱

同时不同的通信链路传输数据的速率也不同，而传输速率使用的单位是比特/秒（bit/s、bps）。一个端系统向另一个端系统发送数据时，常在发送端将数据分段，然后每段加上首部字节，形成的数据包叫一个个的分组，以在计算机网络上被传输。

分组交换机从它的一条通信链路接收到达的分组，从另一条出通信链路转发该分组。现在典型的分组交换机是：

1. 路由器，常用于核心网
2. 链路层交换机，常用于接入网

从发送端系统到接收端系统，一个分组所经历的一些列的通信链路和分组交换机称为通过该网络的路径（path、route）。



互联网服务提供商（ISP）

端系统通过ISP接入到互联网中。

ISP有：

- 住宅ISP（电缆或者电话公司）
- 公司ISP
- 学校ISP
- WiFi接入ISP
- 移动接入的蜂窝数据ISP

每个ISP自身就是一个由多台分组交换机和多段通信链路组成的网络。

ISP提供的网络接入方式有：

- 线缆调制解调器宽带接入
- DSL宽带接入
- 高速局域网接入
- 移动无线接入
- 直接互联网接入

底层ISP通过连接高层ISP，而高层ISP通过高速光纤链路互联的高速路由器组成。每个ISP都独立管理，运行着IP协议，遵循一定的命名规则和地址规则。



### 互联网存在的作用

为分布式应用程序提供服务的基础设施。

典型的应用程序有：

- 电子邮件
- web应用
- 智能手机应用
- 即时通讯应用
- 视频会议等

这些应用程序并不运行在网络核心中的分组交换机中，而是运行在不同的端系统上(涉及多个相互交换数据的端系统，故它们被称为分布式应用程序)。互联网上的端系统提供了一个套接字接口，该接口规定了运行在一个端系统上的程序请求互联网基础设施向运行在另一个端系统上的特定的程序交付数据的方式。互联网套接字接口是一套发送程序必须遵守的规则集合。



**协议**

端系统、分组交换机和其他硬件上都运行了一些列的协议，通过协议控制数据包的接受和发送，典型的协议是TCP协议和IP协议。规定了报文发送或者接受的格式和顺序，以及这些报文发送或者接受或者其他事件发生时所采取约定俗成的动作。

为了完成一项工作，要求两个（或多个）通信实体运行相同的协议。报文的交换以及发送和接收这些报文时所采取的动作是定义一个协议的关键元素。

计算机网络广泛地使用了协议。不同的协议用于完成不同的通信任务。**掌握计算机网络的知识的过程就是理解网络协议的构成、原理和工作方式的过程。**





## 网络边缘

端系统：网络的边缘主要就是各种端系统，这些端系统上运行着各种应用程序。端系统有时被进一步划分为：客户端和服务器。

接入网：将端系统物理意义上连接到其边缘的路由器上的网络。边缘路由器是端系统到任何其他远程端系统的路径上的第一台路由器。

接入链路和几种使用接入网的环境：

1. 家庭接入：DSL、电缆、FTTH、拨号和卫星

   - DSL——数字用户线，住户通常从本地电话公司那里获得DSL互联网接入服务。每个用户的DSL调制解调器使用现有的电话线（即双绞铜线）与位于电话公司的本地中心局（CO）中的数字用户线接入复用器（DSLAM）交换数据。家庭的DSL调制解调器得到数字数据后将其转换为高频音，以通过电话线传输给本地中心局；来自许多家庭的模拟信号在DSLAM处被转换回数字形式。

     ![image-20231115194740030](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20231115194740030.png)

     家庭电话线同时承载了数据和传统的电话信号，它们用不同的频率进行编码。因此一个电话呼叫和一个因特网连接能够同时共享DSL链路。

     

   - 电缆接入——利用了有线电视公司现有的有线电视基础设施。住宅从提供有线电视的公司获得了电缆因特网接入。

     ![image-20231115195154680](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20231115195154680.png)

     电缆互联网接入的一个重要特征是共享广播媒体。特别是，由头端发送的每个分组向下行经每段链路到每个家庭；每个家庭发送的每个分组经上行信道向头端传输。因此，如果几个用户同时经下行信道下载一个视频文件，每个用户接收视频文件的实际速率将大大低于电缆总计的下行速率。而另一方面，如果仅有很少的活跃用户在进行Web冲浪，则每个用户都可以以全部的下行速率接收Web网页。因为上行信道也是共享的，需要一个分布式多路访问协议来协调传输和避免碰撞。

     

   - 光纤到户——从本地中心局直接到家庭提供了一条光纤路径。

   - 卫星链路

   - 使用传统电话线的拨号接入
     

2. 企业（和家庭）接入：以太网和WiFi

   - 使用局域网（LAN）将端系统连接到边缘路由器。以太网用户使用双绞铜线与一台以太网交换机相连。以太网交换机或这样相连的交换机网络，则再与更大的因特网相连。使用以太网接入，用户通常以100Mbps或1Gbps速率接入以太网交换机，而服务器可能具有lGbps甚至lOGbps的接入速率。

     ![image-20231115200020007](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20231115200020007.png)

     

   - wifi，在无线LAN环境中，无线用户从/到一个接入点发送/接收分组，该接入点与企业网连接（很可能使用了有线以太网），企业网再与有线因特网相连。

     

3. 广域无线接入：3G和LTE

   应用与蜂窝移动电话相同的无线基础设施，通过蜂窝网提供运营的基站来发送和接收分组。与WiFi不同的是，一个用户仅需要位于基站的数万米(而不是几十米)范围内。

 



**传输媒介**

导引型媒介和非导引型媒介。对于导引型媒体, 电波沿着固体媒体前行，如光缆、双绞铜线或同轴电缆。对于非导引型媒体，电波在空气或外层空间中传播，例如在无线局域网或数字卫星频道中。

1. 双绞铜线——最便宜并且最常用的导引型传输媒体。

   通常许多双绞线捆扎在一起形成一根电缆，并在这些双绞线外面覆盖上保护性防护层。一对电线构成了一个通信链路。无屏蔽双绞线(Unshielded Twisted Pair, UTP)常用在建筑物内的计算机网络中，即用于局域网(LAN)中。目前局域网中的双绞线的数据速率从10Mbps到10Gbpso所能达到的数据传输速率取决于线的粗细以及传输方和接收方之间的距离。
   双绞线最终已经作为高速LAN联网的主导性解决方案。

2. 同轴电缆——同轴电缆由两个铜导体组成，但是这两个导体是同心的而不是并行的。

   同轴电缆能被用作导引型共享媒体(shared medium) o特别是，许多端系统能够直接与该电缆相连，每个端系统都能接收由其他端系统发送的内容

3. 光纤——一种细而柔软的、能够导引光脉冲的媒体，每个脉冲表示一个比特。

4. 陆地无线电信道——无线电信道承载电磁频谱中的信号。它不需要安装物理线路，并具有穿透墙壁、提供与移动用户的连接以及长距离承载信号的能力。

   陆地无线电信道能够大致划分为三类：一类运行在很短距离（如1米或2米）；另一类运行在局域，通常跨越数十到几百米；第三类运行在广域，跨越数万米。

5. 卫星无线电信道——一颗通信卫星连接地球上的两个或多个微波发射器/接收器，它们被称为地面站。该卫星在一个频段上接收传输，使用一个转发器再生信号，并在另一个频率上发射信号。通信中常使用两类卫星：同步卫星和近地轨道卫星



## 网络核心

由互联了端系统的分组交换机和链路构成的网络。

通过网络链路和交换机移动数据有两种基本方法：电路交换（circuit switching）和分组交换（packet switching） 。

### 分组交换

端系统上的各种网络应用需要彼此交换**报文（message）**，报文可以表示一种控制指令，也可以包含数据。为了从源端系统向目的端系统发送一个报文，源将长报文划分为较小的数据块，称之为分组（packet） 在源和目的地之间，每个分组都通过通信链路和分组交换机（packet switch ）传送。

分组以等于该链路最大传输速率的速度传输通过通信链路。因此，如果某源端系统或分组交换机经过一条链路发送一个厶比特的分组，链路的传输速率为尺比特/秒，则传输该分组的时间为L/R秒。

1. 存储转发

   多数分组交换机在链路的输入端使用**存储转发传输**（store-and-forward transmission）机制。存储转发传输是指在交换机能够开始向输岀链路传输该分组的第一个比特之前，必须接收到整个分组。

   ![image-20231116083712502](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20231116083712502.png)

   计算上图中，从源开始发送分组到目的地收到整个分组所经过的时间，忽略传播时延（指这些比特以接近光速的速度跨越线路所需要的时间）。源在时刻0开始传输，在时刻厶/R秒,因为该路由器刚好接收到整个分组，所以它能够朝着目的地向出链路开始传输分组；在时刻20/尺，路由器已经传输了整个分组，并且整个分组已经被目的地接收。所以，总时延是2L/R。如果交换机一旦比特到达就转发比特（不必首先收到整个分组），则因为比特没有在路由器保存，总时延将是L/R。

   

   从源开始发送第一个分组到目的地接收到所有N个分组所需的时间：N*L/R

   

   通过由N条速率均为R的链路组成的路径（所以,在源和目的地之间有/V-1台路由器），从源到目的地发送一个分组。应用如上相同的逻辑, 我们看到端到端时延是：

   ![image-20231116084910898](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20231116084910898.png)

   

2. 排队时延和分组丢失

   每台分组交换机有多条链路与之相连。对于每条相连的链路，该分组交换机具有一个输出缓存（output buffer,也称为输出队列（output queue））,它用于存储路由器准备发往那条链路的分组。

   如果完整到达的分组需要传输到某条链路，但发现该链路正忙于传输其他分组，该到达分组必须在输出缓存中等待。因此，除了存储转发时延以外，分组还要承受输岀缓存的排队时延（queuing delay）。这些时延是变化的，变化的程度取决于网络的拥塞程度。因为缓存空间的大小是有限的，一个到达的分组可能发现该缓存已被其他等待传输的分组完全充满了。在此情况下，将出现分组丢失（丢包）（packet loss）,到达的分组或已经排队的分组之一将被丢弃。

   ![image-20231116085548494](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20231116085548494.png)

   假定主机A和B向主机E发送分组。主机A和B先通过100Mbps的以太网链路向第一个路由器发送分组。该路由器则将这些分组导向到一条15Mbps的链路。在某个短时间间隔内，如果分组到达路由器的到达率（转换为每秒比特）超过了 15Mbps,这些分组在通过链路传输之前，将在链路输出缓存中排队，在该路由器中将出现拥塞。例如，如果主机A和主机B每个都同时发送了5个紧接着的分组突发块，则这些分组中的大多数将在队列中等待一些时间。

   

3. 转发表和路由选择协议

   路由器从与它相连的一条通信链路得到分组，然后向与它相连的另一条通信链路转发该分组。但是路由器怎样决定它应当向哪条链路进行转发呢？不同的计算机网络实际上是以不同的方式完成分组转发的。这里，简要介绍在互联网中所采用的方法。

   在互联网中，每个端系统具有一个称为IP地址的地址。当源主机要向目的端系统发送一个分组时，源在该分组的首部包含了目的地的IP地址。该地址具有一种等级结构。当一个分组到达网络中的路由器时，路由器检查该分组的目的地址的**一部分**，并向一台相邻路由器转发该分组。更特别的是，每台路由器具有一个路由表(forwarding table),用于将目的地址(或目的地址的一部分)映射成为输岀链路。当某分组到达一台路由器时，路由器检查该地址，并用这个目的地址搜索其转发表，以发现适当的出链路。路由器则将分组导向该出链路。
   端到端选路过程可以类比为一个到一个地方然后询问当地人接下来往哪里走的过程。路由器使用分组的目的地址来索引转发表并决定适当的出链路。

   路由表是如何进行设置的？可以通过人工对每台路由器逐台进行配置，也可以是路由器自动进行配置。

   互联网具有一些特殊的路由选择协议，用于自动地设置这些路由表。例如，一个路由选择协议可以决定从每台路由器到每个目的地的最短路径，并使用这些最短路径结果来配置路由器中的路由表。



### 电路交换

在电路交换网络中，在端系统间通信会话期间，预留了端系统间沿路径通信所需要的资源（缓存，链路传输速率）。在分组交换网络中，这些资源则不是预留的；会话的报文按需使用这些资源，其后果可能是不得不等待（即排队）接入通信线路。

传统的电话网络是电路交换网络的例子。考虑当一个人通过电话网向另一个人发送信息（语音或传真）时所发生的情况。在发送方能够发送信息之前，该网络必须在发送方和接收方之间建立一条连接。这是一个名副其实的连接，因为此时沿着发送方和接收方之间路径上的交换机都将为该连接维护连接状态。用电话的术语来说，该连接被称为一条电路（circuit） 。当网络创建这种电路时，它也在连接期间在该网络链路上预留了恒定的传输速率（表示为每条链路传输容量的一部分）。既然已经为该发送方-接收方连接预留了带宽,则发送方能够以确保的恒定速率向接收方传送数据。



**电路交换网络中的复用**

**频分复用（FDM）**或者**时分复用（TDM）**

对于FDM,链路的频谱由跨越链路创建的所有连接共享。特别是，在连接期间链路为每条连接专用一个频段。在电话网络中，这个频段的宽度通常为4kHz （即每秒4000周期）。毫无疑问，该频段的宽度称为带宽（band width）。调频无线电台也使用FDM来共享88MHz ~ 108MHz的频谱，其中每个电台被分配一个特定的频段

对于TDM，时间被划分为固定期间的帧，并且每个帧又被划分为固定数量的时隙。当网络跨越一条链路创建一条连接时.网络在每个帧中为该连接指定一个时隙。这些时隙专门由该连接单独使用，一个时隙（在每个帧内）可用于传输该连接的数据。

![image-20231116130815851](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20231116130815851.png)

电路交换因为在静默期（silent period）专用电路空闲而不够经济。例如，打电话的一个人停止讲话，空闲的网络资源（在沿该连接路由的链路中的频段或时隙）不能被其他进行中的连接所使用。创建端到端电路和预留端到端带宽是复杂的，需要复杂的信令软件以协调沿端到端路径的交换机的操作。





分组交换和电路交换对比：

一台主机要经过分组交换网络向另一台主机发送分组所发生的情况。与使用电路交换相同，该分组经过一系列通信链路传输。但与电路交换不同的是，该分组被发送进网络，而不预留任何链路资源之类的东西。如果此时其他分组也需要经该链路进行传输而使链路之一出现拥塞，则该分组将不得不在传输链路发送侧的缓存中等待而产生时延。因特网尽最大努力以实时方式交付分组，但它不做任何保证。

分组交换：

1. 提供了比电路交换更好的带宽共享
2. 比电路交换更简单、更有效，实现成本更低

分组交换更加高效的数学证明：

案例一：假定多个用户共享一条1Mbps链路，再假定每个用户活跃周期是变化的，某用户时而以100kbps恒定速率产生数据，时而静止——这时用户不产生数据。进一步假定该用户仅有10%的时间活跃（余下的90%的时间空闲下来喝咖啡）。

对于电路交换，在所有的时间内必须为每个用户预留100kbpso例如，对于电路交换的TDM,如果一个1s的帧被划分为10个时隙，每个时隙为100ms,则每帧将为每个用户分配一个时隙.因此，该电路交换链路仅能支持10 （ =lMbps/l00kbps）个并发的用户。

对于分组交换，一个特定用户活跃的概率是0. 1 （即10% ）。如果有35个用户，有11或更多个并发活跃用户的概率大约是0. 0004。当有10个或更少并发用户（以概率0. 9996发生）时，到达的聚合数据速率小于或等于该链路的输出速率lMbps。因此，当有10个或更少的活跃用户时，通过该链路的分组流基本上没有时延，这与电路交换的情况一样。当同时活跃用户超过10个时，分组的聚合到达速率超过该链路的输出容量，则输出队列将开始变长。（一直增长到聚合输入速率重新低于1Mbps,此后该队列长度才会减少。）因为在本例子中同时活跃用户超过10个的概率极小，分组交换差不多总是提供了与电路交换相同的性能，并且允许在用户数量是其3倍时情况也是如此。

案例二：假定有10个用户，某个用户突然产生1000个1000 比特的分组，而其他用户则保持静默，不产生分组。在每帧具有10个时隙并且每个时隙包含1000比特的TDM电路交换情况下，活跃用户仅能使用每帧中的一个时隙来传输数据，而每个帧中剩余的9个时隙保持空闲。该活跃用户传输完所有10^6比特数据需要10s 的时间。在分组交换情况下，活跃用户能够连续地以1Mbps的全部链路速率发送其分组,因为没有其他用户产生分组与该活跃用户的分组进行复用。在此情况下，该活跃用户的所有数据将在Is内发送完毕。



### 核心网络

接入ISP自身必须互联。以逐步递进方式建造一系列网络结构。

1. 使每个接入ISP直接与每个其他接入ISP连接。
2. 用单一的全球传输ISP互联所有接入ISP。
3. 由数十万接入ISP和多个全球传输ISP组成，全球传输ISP之间必须是互联的。
4. 在任何给定的区域，可能有一个区域ISP (regional ISP),区域中的接入ISP与之连接。每个区域ISP则与第一层ISP (tier-1 ISP)连接。
5. 多个竞争的第一层ISP,而且在一个区域可能有多个竞争的区域ISP。
6. 网络结构3：在某些区域，可能有较大的区域ISP (可能跨越整个国家)，该区域中较小的区域ISP与之相连，较大的区域ISP则与第一层ISP连接。
7. 在等级化网络结构3上增加存在点(Point of Presence, PoP)、多宿、对等和因特网交换点。

   任何ISP (除了第一层ISP)可以选择多宿(multi-home),即可以与两个或更多提供商ISP连接。

   第三方公司能够创建一个因特网交换点(Internet Exchange Point, TXP) , IXF是一个汇合点，多个ISP能够在这里一起对等。在这个生态系统为网络结构4——由接入ISP、区域ISP、第一层ISP、PoP、多宿、对等和IXP组成。
8. 网络结构5——在网络结构4顶部增加内容提供商网络(content provider network )构建而成。

   ![image-20231116194726901](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20231116194726901.png)

客户ISP支付给提供商ISP的费用数额反映了它通过提供商交换的通信流量。

为了减少这些费用，位于相同等级结构层次的邻近一对ISP能够对等(peer),也就是说，能够直接将它们的网络连到一起，使它们之间的所有流量经直接连接而不是通过上游的中间ISP传输。当两个ISP对等时，通常不进行结算，即任一个ISP不向其对等付费。



### 时延、丢包和吞吐量

研究和量化计算机网络中的时延、丢包和吞吐量等问题。

当分组从一个节点(主机或路由器)沿着这条路径到后继节点(主机或路由器)，该分组在沿途的每个节点经受了几种不同类型的时延。

典型的时延：

1. 节点处理时延(nodal processing delay) 
2. 排队时延(queuing delay)
3. 传输时延(transmission delay)
4. 传播时延(propagation delay)

这些时延总体累加起来是节点总时延(tolal nodal delay)。

![image-20231117124842391](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20231117124842391.png)

在路由器A刻画出节点时延：

路由器A具有通往路由器B的出链路。该链路前面有一个队列(也称为缓存)。当分组从上游节点到达路由器A时，路由器A检查该分组的首部以决定它的适当岀链路，并将该分组导向该链路。仅当在该出链路没有其他分组正在传输并且没有其他分组排在该队列前面时，才能在这条链路上传输该分组；如果该链路当前正繁忙或有其他分组已经在该链路上排队，则新到达的分组将加入排队。



**处理时延**

检查分组首部和决定将该分组导向哪条出链路所需要的时间是处理时延。处理时延也能够包括其他因素，如检查比特级别的差错所需要的时间，该差错岀现在从上游节点向路由器A传输这些分组比特的过程中。



**排队时延**

在处理分组结束后，路由器将该分组引向通往路由器B链路之前的队列。在队列中，当分组在链路上等待传输时，它经受排队时延。一个特定分组的排队时延长度将取决于先期到达的正在排队等待向链路传输的分组数量。如果该队列是空的，并且当前没有其他分组正在传输，则该分组的排队时延为0。另一方面，如果流量很大，并且许多其他分组也在等待传输，该排队时延将很长。



**传输时延**

假定分组以先到先服务方式传输，仅当所有已经到达的分组被传输后，才能传输刚到达的分组。用L比特表示该分组的长度，用R bps(即b/s)表示从路由器A到路由器B的链路传输速率。传输时延是L/R。这是将所有分组的比特推向链路(即传输，或者说发射)所需要的时间。



**传播时延**

一旦一个比特被推向链路，该比特需要向路由器B传播。从该链路的起点到路由器B传播所需要的时间是传播时延。该比特以该链路的传播速率传播。传播速度等于或者略小余光速。传播时延等于两台路由器之间的距离除以传播速率。即传播时延是其中d是路由器A和路由器B之间的距离， s是该链路的传播速率。



**传输时延和传播时延的比较 **

传输时延是路由器推出分组所需要的时间，它是分组长度和链路传输速率的函数，而与两台路由器之间的距离无关。另一方面，传播时延是一个比特从一台路由器传播到另一台路由器所需要的时间，它是两台路由器之间距离的函数，而与分组长度或链路传输速率无关。





**排队时延和丢包**

排队时延对不同的分组可能是不同的。例如，如果10个分组同时到达空队列，传输的第一个分组没有排队时延，而传输的最后一个分组将经受相对大的排队时延。因此，当表征排队时延时，人们通常使用统计量来度量，如平均排队时延、排队时延的方差和排队时延超过某些特定值的概率。

排队时延的大小很大程度取决于流量到达该队列的速率、链路的传输速率和到达流量的性质，即流量是**周期性到达**还是以突发形式到达。例子：令a表示分组到达队列的平均速率（a的单位是分组/秒，即pkt/s）。R是传输速率，即从队列中推出比特的速率（以bps即b/s为单位）。简单起见，也假定所有分组都是由L比特组成的。则比特到达队列的平均速率是L\*a bps。最后，假定该队列非常大，因此它基本能容纳无限数量的比特。比率L\*a/R被称为流量强度（traffic intensity）,它在估计排队时延的范围方面经常起着重要的作用。如果L\*a/R>l,则比特到达队列的平均速率超过从该队列传输岀去的速率。在这种情况下，该队列趋向于无限增加，并且排队时延将趋向无穷大！因此，流量工程中的一条原则：设计系统时流量强度不能大于1。

L\*a/R<= 1时的情况。这时，到达流量的性质影响排队时延。例如，如果分组周期性到达，即每L/R秒到达一个分组，则每个分组将到达一个空队列中，不会有排队时延。另一方面，如果分组以突发形式到达而不是周期性到达，则可能会有很大的平均排队时延。例如，假定每（L/R）N秒同时到达N个分组。则传输的第一个分组没有排队时延;传输的第二个分组就有L/R秒的排队时延；更为一般地，第几个传输的分组具有（n-1）L/R秒的排队时延。



![image-20231118184456897](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20231118184456897.png)

**丢包**

实际中，一条链路前的队列只有有限的容量，到达的分组将发现一个满的队列。由于没有地方存储这个分组，路由器将丢弃(drop)该分组，即该分组将会丢失(lost) 。



### 端到端吞吐量

在任何时刻的瞬时吞吐量（instantaneous throughput）是主机接收到该数据的速率（以bps计）。如果该数据由F比特组成，主机接收到所有F比特用去T秒,则文件传送的平均吞吐量（average throughput.）是F/T bps。吞吐量取决于数据流过的链路的传输速率。当没有其他干扰流量时，其吞吐量能够近似为沿着源和目的地之间路径的最小传输速率。



### 协议分层

每个层次与其下面的层次结合在一起，实现了某些功能、服务。利用分层的体系结构，可以认识一个大而复杂系统的特定部分。某层所提供的服务实现易于改变。只要该层对其上面的层提供相同的服务，并且使用来自下面层次的相同服务，当某层的实现变化时，该系统的其余部分保持不变。

网络协议也是以分层的方式来进行安排的。网络硬件和软件也是以层为划分来进行设计和开发的。每层通过在该层中执行某些动作或使用直接下层的服务来提供服务。例如，由第n层提供的服务可能包括报文从网络的一边到另一边的可靠交付。这可能是通过使用第n-1层的边缘到边缘的不可靠报文传送服务，加上第几层的检测和重传丢失报文的功能来实现的。 

一个协议层能够用软件、硬件或两者的结合来实现实现本层的服务。HTTP和SMTP协议几乎总是在端系统中用软件实现，运输层协议也是如此。

物理层和数据链路层负责处理跨越特定链路的通信，它们通常在与给定链路相关联的网络接口卡（例如以太网或WiFi接口卡）中实现。网络层经常是硬件和软件实现的混合体。

某层协议可能分布在互联网中的各个端系统，分组交换机和其他组件中。

各层的所有协议被统称为协议栈（protocol stack） 。互联网分层：物理层、链路层、网络层、运输层和应用层。

![image-20231118192122188](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20231118192122188.png)



#### 应用层

网络应用程序及它们的应用层协议存留的地方。

应用层协议有：

1. HTTP：提供了 Web文档的请求和传送
2. SMTP：提供了电子邮件报文的传输
3. FTP：提供两个端系统之间的文件传送
4. DNS协议：用于将域名解析为IP地址

应用层协议分布在多个端系统上，而一个端系统中的应用程序使用协议与另一个端系统中的应用程序交换信息分组。把这种位于应用层的信息分组称为**报文（message）**。



#### 传输层

运输层在应用程序端点之间传送应用层报文。互联网中有两种运输协议，即TCP和UDP,利用其中的任一个都能运输应用层报文。

TCP向它的应用程序提供了面向连接的服务。这种服务包括了应用层报文向目的地的确保传递和流量控制（即发送方/接收方速率匹配）。TCP也将长报文划分为短报文，并提供拥塞控制机制，因此当网络拥塞时，源抑制其传输速率。

UDP协议向它的应用程序提供无连接服务。这是一种不提供不必要服务的服务，没有可靠性，没有流量控制，也没有拥塞控制。

把运输层的分组称为**报文段 (segment)** 。



#### 网络层

网络层负责将称为**数据报（datagram）**的网络层分组从一台主机移动到另一台主机。在一台源主机中的互联网传输层协议（TCP或UDP）向网络层递交传输层报文段和目的地址。

网络层典型的协议是：网际协议（IP）和路由选择协议，网际协议定义了在数据报中的各个字段以及端系统和路由器如何作用于这些字段。IP仅有一个，所有具有网络层的互联网组件必须运行IP。决定路由的路由选择协议，它根据该路由将数据报从源传输到目的地。互联网具有许多路由选择协议。

网络层通过源和目的地之间的一系列路由器路由数据报。



#### 链路层

为了将分组从一个节点（主机或路由器）移动到路径上的下一个节点，网络层必须依靠该链路层的服务。在**每个节点**，网络层将数据报下传给链路层，链路层沿着路径将数据报传递给下一个节点。在该下一个节点，链路层将数据报上传给网络层。

链路层提供的服务取决于应用于该链路的特定链路层协议。某些协议基于链路提供可靠传递，从传输节点跨越一条链路到接收节点。但是这种可靠的传递服务不同于TCP的可靠传递服务，TCP提供从一个端系统到另一个端系统的可靠交付。

链路层的例子包括以太网、WiFi和电缆接入网的DOCSIS协议。

因为数据报从源到目的地传送通常需要经过几条链路，一个数据报可能被沿途不同链路上的不同链路层协议处理。例如，一个数据报可能被一段链路上的以太网和下一段链路上的PPP所处理。网络层将受到来自每个不同的链路层协议的不同服务。

把链路层分组称为**帧（fnmie）**。

链路层的任务是将整个帧从一个网络元素移动到邻近的网络元素。



#### 物理层

将帧中的一个个比特从一个节点移动到下一个节点。在这层中的协议是和链路相关的，并且进一步与该链路（例如，双绞铜线、单模光纤）的实际传输媒体相关。例如，以太网具有许多物理层协议：一个是关于双绞铜线的，另一个是关于同轴电缆的，还有一个是关于光纤的等。在每种场合中，跨越这些链路移动一个比特是以不同的方式进行的。







### OSI七层参考模型

国际标准化组织（ISO）提出计算机网络围绕7层来组织，称为开放系统互连（OSI）模型。

7层是：应用层、表示层、会话层、运输层、网络层、数据链路层和物理层。

表示层的作用是使通信的应用程序能够解释交换数据的含义。这些服务包括数据压缩和数据加密（它们是自解释的）以及数据描述。会话层提供了数据交换的定界和同步功能，包括了建立检查点和恢复方案的方法。



### 封装

路由器和链路层交换机都是分组交换机。路由器和链路层交换机也是以多层次的方式组织它们的网络硬件和软件。而路由器和链路层交换机并不实现协议栈中的所有层次。

![image-20231118222658046](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20231118222658046.png)

链路层交换机实现了第一层和第二层；路由器实现了第一层到第三层。路由器能够实现IP协议，而链路层交换机则不能。尽管链路层交换机不能识别IP地址，但它们能够识别第二层地址，如以太网地址。

**封装**

传输层接收到来自应用层的报文并附上附加信息（传输层首部）组成报文段。该首部将被接收端的传输层使用。

传输层向网络层传递报文段，网络层基于报文段增加了如源和目的端系统地址等网络层首部信息，得到数据报。

数据报接下来被传递给链路层，链路层增加它自己的链路层首部信息并生成链路层帧（link layer亦me）。

在每一层，一个分组具有两种类型的字段：首部字段和有效载荷字段（payload field） 。有效载荷通常是来自上一层的分组。

一个大报文可能被划分为多个传输层的报文段（这些报文段每个可能被划分为多个网络层数据报）。在接收端，则必须从其连续的数据报中重构这样一个报文段。





### 网络安全

如何攻击计算机网络，流行的攻击类型，如何防御以免受他们的攻击，或者更好的是设计能够事先免除这样的攻击的新型体系结构。



**感染个人PC**

恶意软件（malware）,它们能够进入并感染设备。一旦恶意软件感染设备，就能够做各种不正当的事情，包括删除文件，安装间谍软件来收集隐私信息。

受害主机也可能和其他数以千计的类似受害设备，组成僵尸网络（botnet）,黑客然后利用僵尸网络控制并有效地对目标主机展开垃圾邮件分发或分布式拒绝服务攻击。

病毒（virus）是一种需要某种形式的用户交互来感染用户设备的恶意软件。典型的例子是包含恶意可执行代码的电子邮件附件。

蠕虫（worm）是一种无须任何明显用户交互就能进入设备的恶意软件。用户也许运行了一个攻击者能够发送恶意软件的脆弱网络应用程序。在某些情况下，没有用户的任何干预，该应用程序可能从因特网接收恶意软件并运行它，生成了蠕虫。新近感染设备中的蠕虫则能扫描因特网，搜索其他运行相同网络应用程序的易受感染的主机。当它发现其他易受感染的主机时，便向这些主机发送一个它自身的副本。



**攻击服务器或者网络基础设施**

拒绝服务攻击（Denial-of Service （ DoS） attack） 。DoS攻击使得网络、主机或其他基础设施部分不能由合法用户使用。Web服务器、电子邮件服务器、DNS服务器和机构网络都能够成为DoS攻击的目标。

大多数互联网DoS攻击属于下列三种类型之一：

1. **弱点攻击。**向一台目标主机上运行的易受攻击的应用程序或操作系统发送制作精细的报文。如果适当顺序的多个分组发送给一个易受攻击的应用程序或操作系统，该服务器可能停止运行，或者更糟糕的是主机可能崩溃。
2. **带宽洪泛。**攻击者向目标主机发送大量的分组，分组数量之多使得目标的接入链路变得拥塞，使得合法的分组无法到达服务器。
3. **连接洪泛。**攻击者在目标主机中创建大量的半开或全开TCP连接。该主机因这些伪造的连接而陷入困境，并停止接受合法的连接。



带宽洪泛攻击：如果某服务器的接入速率为R bps,则攻击者将需要以大约R bps的速率来产生危害。如果R非常大的话，单一攻击源可能无法产生足够大的流量来伤害该服务器。

如果从单一源发岀所有流量的话，某上游路由器就能够检测出该攻击并在该流量靠近服务器之前就将其阻挡下来。下图中显示的分布式DoS ( Distributed DoS, DDoS)中，攻击者控制多个源并让每个源向目标猛烈发送流量。使用这种方法，遍及所有受控源的聚合流量速率需要大约R的能力来使该服务陷入瘫痪。DDoS攻击充分利用由数以千计的受害主机组成的僵尸网络。相比于来自单一主机的DoS攻击，DDoS攻击更加难以检测和防范。

![image-20231118225419901](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20231118225419901.png)



**嗅探分组**

在无线传输设备的附近放置一台被动的接收机，该接收机就能得到传输的每个分组的副本。这些分组包含了各种敏感信息。记录每个流经的分组副本的被动接收机被称为分组嗅探器(packet sniffer) 。

嗅探器也能够部署在有线环境中。如在许多以太网LAN中，分组嗅探器能够获得经该LAN发送的所有分组。



电缆接入技术也广播分组，因此易于受到嗅探攻击。此外，获得某机构与互联网连接的接入路由器或接入链路访问权的人能够放置一台嗅探器以产生从该机构出入的每个分组的副本，再对嗅探到的分组进行离线分析，就能得出敏感信息。

Wireshark就是一个嗅探分组软件。

因为分组嗅探器是被动的，它们不向信道中注入分组，所以难以检测到它们。因此，当向无线信道发送分组时，必须接受这样的可能性，即某些坏家伙可能记录了分组的副本。



**身份伪装**

生成具有任意源地址、分组内容和目的地址的分组，然后将这个人工制作的分组传输到互联网中。想象某个接收到这样一个分组的不会猜疑的接收方（比如说一台因特网路由器），将该（虚假的）源地址作为真实的，进而执行某些嵌入在该分组内容中的命令（比如说修改它的转发表）。将具有虚假源地址的分组注入因特网的能力被称为IP哄骗（IP spoofing）。

为了解决这个问题，需要采用**端点鉴别**，即一种使我们能够确信一个报文源自我们认为它应当来自的地方的机制。





## 应用层

计算机网络是为网络应用提供服务的。

典型的网络应用：

1. 文本电子邮件
2. 远程访问计算机
3. 文件传输和新闻组
4. 万维网，包括Web冲浪、搜索和电子商务
5. 即时讯息和对等（P2P）文件共享
6. IP电话（VoIP）、视频会议
7. 用户生成的视频和点播电影
8. 多方在线游戏
9. 社交网络应用 
10. 移动端应用

本章讲述有关网络应用的原理和实现方面的知识。定义关键的应用层概念，应用程序所需要的网络服务、客户和服务器、进程和运输层接口。套接字接口。

几种网络应用程序：Web、电子邮件、DNS、对等文件分发和视频流。

研发网络应用程序的核心是写出能够运行在不同的端系统和通过网络彼此通信的程序。在Web应用程序中，有两个互相通信的不同的程序：一个是运行在用户主机上的浏览器程序；另一个是运行在Web服务器主机上的Web服务器程序。



### 应用程序体系结构

由应用程序研发者设计规定了如何在各种端系统上组织该应用程序。在选择应用程序体系结构时，现代网络应用程序中的两种主流体系结构：**客户-服务器体系结构**或**对等（P2P）体系结构**。



**客户-服务器体系结构**

有一个总是打开的主机称为服务器，它服务于来自许多其他称为客户的主机的请求。该服务器具有固定的、周知的地址，该地址称为IP地址。客户总是能够通过向该服务器的IP地址发送分组来与其联系。具有客户-服务器体系结构的应用程序包括Web、FTP、Telnet和电子邮件。

![image-20231121135147106](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20231121135147106.png)

在客户-服务器应用中，常会出现一台单独的服务器主机跟不上它所有客户请求的情况。例如，一个网络站点如果仅有一台服务器来处理所有请求，将很快变得不堪重负。为此，配备大量主机的数据中心（data center）常被用于创建强大的虚拟服务器。最为流行的因特网服务一一如搜索引擎（如谷歌、Bing和百度）、因特网商务（如亚马逊、e-Bay和阿里巴巴）、基于Web的电子邮件（如Gmail和雅虎邮件）、社交网络（如脸书、Instagram推特和微信），就应用了一个或多个数据中心。

服务提供商必须支付不断出现的互联和带宽费用，以发送和接收到达/来自数据中心的数据。



**P2P 体系结构**

在 P2P 体系结构中，对数据中心的专用服务器有最小的（或者没有）依赖。应用程序在间断连接的主机对之间直接通信，这些主机对被称为**对等方**。这些对等方并不为服务提供商所有，而是用户控制的桌面机。因为这种对等方通信不必通过专门的服务器，该体系结构被称为对等方到对等方的。典型的应用包括文件共享、对等方协助下载加速器（例如迅雷）、因特网电话和视频会议。

![image-20231121135731445](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20231121135731445.png)

某些应用具有混合的体系结构，它结合了客户-服务器和P2P的元素。例如，对于许多即时讯息应用而言，服务器被用于跟踪用户的IP地址，但用户到用户的报文在用户主机之间（无须通过中间服务器）直接发送。



### 进程通信

运行在多个端系统上的程序是如何互相通信的。进行通信的实际上是进程（process）而不是程序。一个进程可以被认为是运行在端系统中的一个程序。当多个进程运行在相同的端系统上时，它们使用进程间通信机制相互通信。进程间通信的规则由端系统上的操作系统确定。

在两个不同端系统上的进程，通过跨越计算机网络交换报文（message）而相互通信。发送进程生成并向网络中发送报文；接收进程接收这些报文并可能通过回送报文进行响应。



#### 客户和服务器进程

网络应用程序由成对的进程组成，这些进程通过网络相互发送报文。对每对通信进程，通常将这两个进程中的一方标识为客户（client），而另一方进程标识为服务器（serve）。

在一对进程之间的通信会话场景中，发起通信（即在该会话开始时发起与其他进程的联系）的进程被标识为客户，在会话开始时等待联系的进程是服务器。



#### 套接字接口

进程通过一个称为套接字（sock,el）的软件接口向网络发送报文和从网络接收报文。套接字是同一台主机内应用层与运输层之间的接口。由于该套接字是建立网络应用程序的可编程接口，因此套接字也称为应用程序和网络之间的应用程序编程接（Application Programming Interface, API） 。

应用程序开发者可以控制套接字在应用层端的一切，但是对该套接字的运输层端几乎没有控制权。应用程序开发者对于运输层的控制仅限于：①选择运输层协议；②也许能设定几个运输层参数，如最大缓存和最大报文段长度等。

![image-20231121201829618](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20231121201829618.png)



#### 寻址

在一台主机上运行的进程为了向在另一台主机上运行的进程发送分组，接收进程需要有一个地址。为了标识该接收进程，需要定义两种信息：①主机的地址；②在目的主机中指定接收进程的标识符。

主机的地址：由其IP地址(IP address)标识（一个32比特的值）。

接收进程：端口号(port number）用于标识进程。指定运行在接收主机上的接收进程(更具体地说，接收套接字)。因为一般而言一台主机能够运行许多网络应用,这些信息是需要的。

流行的应用分配有特定的端口号。例如，Web服务器用端口号80来标识。邮件服务器进程(使用SMTP协议)用端口号25来标识。



#### 服务特点

互联网提供了不止一种运输层协议。当开发一个应用时，必须选择一种可用的运输层协议。

如何选择协议？通过研究这些可用的运输层协议所提供的**服务**，选择一个最能为应用需求提供恰当服务的协议。

传输层可以提供的服务的特点：

1. 可靠数据传输
2. 吞吐量
3. 定时
4. 安全性



**可靠数据传输**

分组在计算机网络中可能丢失。例如，分组能够使路由器中的缓存溢岀，或者当分组中的某些比特损坏后可能被丢弃。

一些应用是完全不能接受数据丢失的，因此，为了支持这些应用，必须做一些工作以确保由应用程序的一端发送的数据正确、完全地交付给该应用程序的另一端。如果一个协议提供了这样的确保数据交付服务，就认为提供了可靠数据传输(reliable data transfer) 。当一个传输协议提供这种服务时，发送进程只要将其数据传递进套接字，就可以完全相信该数据将能无差错地到达接收进程。

一些应用能接受一定量数据的丢失，可以采用不提供可靠数据传输的传输层协议。


**吞吐量**

在沿着一条网络路径上的两个进程之间的通信会话场景中，可用吞吐量就是发送进程能够向接收进程交付比特的速率。因为其他会话将共享沿着该网络路径的带宽，并且因为这些会话将会到达和离开，该可用吞吐量将随时间波动。

这导致另一种服务类型的产生，即传输层协议能够以某种特定的速率提供确保的可用吞吐量。

使用这种服务，该应用程序能够请求R比特/秒的确保吞吐量，并且该运输协议能够确保可用吞吐量总是为至少R比特/秒。例如，如果因特网电话应用程序对语音以32kbps的速率进行编码，那么它需要以这个速率向网络发送数据，并以该速率向接收应用程序交付数据。如果运输协议不能提供这种吞吐量，该应用程序或以较低速率进行编码（并且接收足够的吞吐量以维持这种较低的编码速率），或它可能必须放弃发送.这是因为对于这种因特网电话应用而言，接收所需吞吐量的一半是几乎没有或根本没有用处的。具有吞吐量要求的应用程序被称为带宽敏感的应用（bandwidth-sensitive application） 。

某些多媒体应用程序可能采用自适应编码技术对数字语音或视频以与当前可用带宽相匹配的速率进行编码。



弹性应用（elastic application）能够根据当时可用的带宽或多或少地利用可供使用的吞吐量。电子邮件、文件传输以及Web传送都属于弹性应用。



**定时**

例如：发送方注入进套接字中的每个比特到达接收方的套接字不迟于100ms。这种服务将对交互式实时应用程序有吸引力，如因特网电话、虚拟环境、电话会议和多方游戏。



**安全性**

传输层协议能够为应用程序提供一种或多种安全性服务。例如，在发送主机中，传输层协议能够加密由发送进程传输的所有数据，在接收主机中，传输层协议能够在将数据交付给接收进程之前解密这些数据。这种服务将在发送和接收进程之间提供机密性，以防该数据以某种方式在这两个进程之间被观察到。运输协议还能提供除了机密性以外的其他安全性服务，包括数据完整性和端点鉴别。





### 传输服务

具体的传输服务类型。互联网中两个典型的传输层协议：

1. TCP
2. UDP

一个网络应用首先需要确定选择哪种传输层协议。每个协议为调用它们的应用程序提供了不同的服务集合。

以下是不同的网络引用对服务的要求：

![image-20231121211805723](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20231121211805723.png)



#### TCP服务

TCP服务特点：面向连接服务和可靠数据传输服务。当某个应用程序调用TCP作为其运输协议时，该应用程序就能获得来自TCP的这两种服务。

**面向连接的服务**

在应用层数据报文开始流动之前，TCP让客户和服务器互相交换传输层控制信息。这个握手过程提醒客户和服务器，让它们为大量分组的到来做好准备。在握手阶段后，一个TCP连接（TCP connection）就在两个进程的套接字之间建立了。这条连接是全双工的，即连接双方的进程可以在此连接上同时进行报文收发。当应用程序结束报文发送时，必须拆除该连接。



**可靠的数据传送服务**

通信进程能够依靠TCP，无差错、按适当顺序交付所有发送的数据。当应用程序的一端将字节流传进套接字时，它能够依靠TCP将相同的字节流交付给接收方的套接字，而没有字节的丢失和冗余。



**拥塞控制**

这种服务不一定能为通信进程带来直接好处，但能为因特网带来整体好处。当发送方和接收方之间的网络出现拥塞时，TCP的拥塞控制机制会抑制发送进程（客户或服务器）。TCP拥塞控制也试图限制每个TCP连接，使它们达到公平共享网络带宽的目的。

无论TCP还是UDP都没有提供任何加密机制，发送进程传进其套接字的数据，与经网络传送到目的进程的数据相同。因此，如果某发送进程以明文方式（即没有加密）发送了一个口令进入它的套接字，该明文口令将经过发送方与接收方之间的所有链路传送，这就可能在任何中间链路被嗅探和发现。为此，互联网研制了 TCP的加强版本，称为安全套接字层（Secure Sockets Layer, SSL） 。

用SSL加强后的TCP不仅能够做传统的TCP所能做的一切，而且提供了关键的进程到进程的安全性服务，包括加密、数据完整性和端点鉴别。

SSL不是与TCP和UDP在相同层次上的第三种因特网运输协议，而是一种对TCP的加强，这种强化是在应用层上实现的。特别是，如果一个应用程序要使用SSL的服务，它需要在该应用程序的客户端和服务器端包括SSL代码（利用现有的、高度优化的库和类）。

当一个应用使用SSL时，发送进程向SSL套接字传递明文数据；在发送主机中的SSL则加密该数据并将加密的数据传递给TCP套接字。加密的数据经因特网传送到接收进程中的TCP套接字。该接收套接字将加密数据传递给SSL,由其进行解密。最后，SSL通过它的SSL套接字将明文数据传递给接收进程。





#### UDP服务

UDP是无连接的，因此在两个进程通信前没有握手过程。UDP协议提供一种不可靠数据传送服务，也就是说，当进程将一个报文发送进UDP套接字时，UDP协议并不保证该报文将到达接收进程。不仅如此，到达接收进程的报文也可能是乱序到达的。

UDP也不提供拥塞控制，所以UDP的发送端可以用它选定的任何速率向其下层（网络层）注入数据。



**传输层协议不提供的服务**

**吞吐量或定时保证**，这些服务目前的互联网传输层协议并没有提供。

一些典型的互联网应用使用的传输协议：

![image-20231121220221423](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20231121220221423.png)





### 应用层协议

发送给套接字接口的应用层报文如何构造？这些报文中的各个字段的含义是什么？进程何时发送这些报文？这些都是应用层协议需要解决的问题。

应用层协议（application-layer protocol）定义了运行在不同端系统上的应用程序进程如何相互传递报文。

应用层协议定义了 ：

- 交换的报文类型，例如请求报文和响应报文。
- 各种报文类型的语法，如报文中的各个字段及这些字段是如何描述的。
- 字段的语义，即这些字段中的信息的含义。
- 确定一个进程何时以及如何发送报文，对报文进行响应的规则

有一些应用层协议是公有的，比如支持web应用的http协议；而有些协议是专有的，比如Skype（视频会议软件）使用了专用的应用层协议。

应用层协议只是网络应用的一部分。



### 网络应用



#### web和http

万维网（WorldWideWeb）

Web的应用层协议是超文本传输协议（HyperText Transfer Protocol, HTTP）。HTTP由两个程序实现：一个客户程序和一个服务器程序。客户程序和服务器程序运行在不同的端系统中，通过交换HTTP报文进行会话。HTTP定义了这些报文的结构以及客户和服务器进行报文交换的方式。

Web页面（Webpage）（也叫文档）是由对象组成的。一个对象（object）只是一个文件，如html，图片，视频与音频等。对象可通过一个URL地址寻址。

一般多数Web页面含有一个HTML基本文件以及其他引用对象。例如，如果一个Web页面包含HTML文本和5个JPEG图形，那么这个Web页面有6个对象。

HTML基本文件通过对象的URL地址引入页面所需的其他对象。每个URL地址由两部分组成：存放对象的服务器主机名和对象的路径名。

URL 地址 `http://www.someSchool.edu/someDepartment/picture. gif`，其中的 `www. someSchool. edu`是主机名，`/someDepartment/picture, gif` 是路径名。

服务器向客户发送被请求的文件，而不存储任何关于该客户的状态信息。假如某个特定的客户在短短的几秒内两次请求同一个对象，服务器并不会因为刚刚为该客户提供了该对象就不再做出反应，而是重新发送该对象，就像服务器已经完全忘记不久之前所做过的事一样。因为HTTP服务器并不保存关于客户的任何信息，所以说HTTP是一个**无状态协议(stateless protocol)**。



一般客户端和服务器进行通信会在一段时间中断断续续进行。

一系列请求可以以规则的间隔周期性地或者间断性地一个接一个发出。应用程序的研制者就需要做一个重要决定，即每个请求/响应对是经一个单独的TCP连接发送，还是所有的请求及其响应经相同的TCP连接发送。采用前一种方法，该应用程序被称为使用非持续连接(non-persistent connection)；采用后一种方法，该应用程序被称为使用持续连接(persistent connection)。

HTTP既能够使用非持续连接，也能够使用持续连接。尽管HTTP在其默认方式下使用持续连接，HTTP客户和服务器也能配置成使用非持续连接。



**非持续连接的http**

例子：请求一个页面，该页面含有10个jpeg图片，并且这11个对象位于同一台服务器。

1. HTTP客户进程在以80为目标端口号发起一个到服务器www. someSchool. edu的TCP连接，该端口号是HTTP的默认端口。在客户和服务器上分别有一个套接字与该连接相关联。
2. HTTP客户经它的套接字向该服务器发送一个HTTP请求报文。请求报文中包含了路径名/someDepartment/home.index。
3. HTTP服务器进程经它的套接字接收该请求报文，从其存储器（RAM或磁盘）中检索出对象 www. someSchool.edu/someDepartment/home. index,在一个 HTTP 响应报文中封装对象，并通过其套接字向客户发送响应报文。
4. HTTP服务器进程通知TCP断开该TCP连接。（但是直到TCP确认客户已经完整地收到响应报文为止，它才会实际中断连接。）
5.  HTTP客户接收响应报文，TCP连接关闭。该报文指岀封装的对象是一个HTML文件，客户从响应报文中提取出该文件，检査该HTML文件，得到对10个JPEG图形的引用。 '
6. 对每个引用的JPEG图形对象重复前4个步骤

每个TCP连接在服务器发送一个对象后关闭，即该连接并不为其他的对象的传输而重复利用，且每个TCP连接只传输一个请求报文和一个响应报文。因此在上面的例子中，当用户请求该Web页面时，要产生11个TCP连接。

那上面的10个jpeg图片是是使用10个串行的TCP连接，还是某些JPEG对象使用了一些并行的TCP连接。事实上，用户能够配置现代浏览器来控制连接的并行度。在默认方式下，大部分浏览器打开5 ~ 10个并行的TCP连接，而每条连接处理一个请求响应事务。如果用户愿意，最大并行连接数可以设置为1,这样10条连接就会串行建立。



通过从客户请求HTML基本文件起到该客户收到整个文件止所花费的时间，给出了往返时间（Round Trip Time, RTF）的定义，该时间是指**一个短分组从客户到服务器然后再返回客户所花费的时间**。RTT包括分组传播时延、分组在中间路由器和交换机上的排队时延以及分组处理时延。

![image-20231122083525279](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20231122083525279.png)



TCP连接涉及一次“三次握手”过程,即客户向服务器发送一个小TCP报文段，服务器用一个小TCP报文段做出确认和响应,最后，客户向服务器返回确认。三次握手中前两个部分所耗费的时间占用了一个RTT。

完成了三次握手的前两个部分后，客户结合三次握手的第三部分（确认）向该TCP连接发送一个HTTP请求报文。一旦该请求报文到达服务器，服务器就在该TCP连接上发送HTML文件。该HTTP请求/响应用去了另一个RTT。因此，粗略地讲，总的响应时间就是两个RTT加上服务器传输HTML文件的时间。

非持续连接的缺点：

1. 必须为每一个请求的对象建立和维护一个全新的连接。对于每个这样的连接，在客户和服务器中都要分配TCP的缓冲区和保持TCP变量，这给Web服务器带来了严重的负担
2. 每一个对象经受两倍RTT的交付时延，即一个RTT用于创建TCP,另一个RTT用于请求和接收一个对象。



**持续连接的http**

HTTP 1.1引入了持续连接，服务器在发送响应后可以保持该TCP连接打开。在相同的客户与服务器之间，后续的请求和响应报文能够通过相同的连接进行传送。

对对象的这些请求可以一个接一个地发出，而不必等待对未决请求（流水线）的回答。一般来说，如果一条连接经过一定时间间隔（一个可配置的超时间隔）仍未被使用，HTTP服务器就关闭该连接。



#### HTTP报文格式

HTTP报文有两种：请求报文和响应报文。



**HTTP请求报文**

典型的HTTP请求报文：

![image-20231122085415545](C:/Users/shuyi/Desktop/learn-notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/images/image-20231122085415545.png)

特征：

1. ASCII文本
2. 每行由一个回车和换行符结束
3. 最后一行后再附加一个回车换行符
4. HTTP请求报文的第一行叫作请求行
5. 请求行有3个字段：方法字段、URL字段和HTTP版本字段
6. 后继的行叫作请求头
