## 第一章

### 传统的计算机应用

所有类型的计算机底层都是使用的一套通用的硬件技术。

1. 个人计算机，面向单个用户，在上面运行第三方程序
2. 服务器，一般通过网络访问，工作负载巨大
3. 嵌入式计算机，数量和应用场景最多，一般专门运行单一的程序或者一组相关的程序，软件功能和硬件集成在一起



### 后PC时代的计算机应用

1. 个人移动设备
2. 云计算，代替传统的服务器，基于仓储级计算机（巨型数据中心）



1960年代左右，计算机的内存非常有限，所以那时的程序开发非常注重内存的占用率，而现在除了嵌入式计算机系统需要非常关注内存使用情况以外，其他程序堆内存的占用率大大减少了对计算机性能的影响。



### 达到的能力

1. 理解高级语言编写的程序如何翻译为机器语言，硬件如何执行机器语言程序

2. 理解软件和硬件之间的接口

3. 影响程序性能的因素和如何改进性能（程序的性能取决于：原始程序代码质量、编译或者解释该语言的系统软件的质量和硬件支持的指令的有效性）

4. 硬件层面提高性能的方法

   



### 程序的性能的决定因素

1. 程序中使用的算法的优劣
2. 用于创建程序并将其翻译为机器指令的系统软件的优劣
3. 计算机硬件执行指令时的有效性

| 软件或硬件的组成部分         | 该部分如何影响性能                     |
| ---------------------------- | -------------------------------------- |
| 算法                         | 决定源码语句的数量和IO操作的数量       |
| 编程语言、编译器或者体系结构 | 决定每条源码语句对应的计算机指令的数量 |
| 处理器和存储系统             | 决定指令的执行速度                     |
| IO系统（硬件和操作系统）     | 决定IO操作的可能的速度                 |

通过不断优化一个矩阵向量相乘的C程序的性能，说明程序在算法，处理器来理解上面的不同部分对性能的影响。





### 计算机体系结构中的8大思想

1. 摩尔定律，单个芯片上所集成的晶体管资源每18到24个月翻一倍
2. 对复杂系统进行抽象来表示不同的设计层次
3. 加速经常性事件
4. 通过并行提高性能
5. 通过流水线提高性能，
6. 通过预测提高性能
7. 划分存储层次
8. 通过冗余提高可靠性





### 程序层次

1. 应用程序
2. 系统软件
3. 硬件

系统软件将应用程序的代码进行解释和编译，生成机器指令以给硬件执行。

系统软件的代表：

1. 操作系统：应用程序和硬件之间的接口，为应用程序提供各种服务和监控功能；处理基本的输入输出操作；分配馆管理内外存；为多个应用程序提供硬件资源服务。
2. 编译器：把高级语言编写的程序翻译为硬件能够识别的机器指令



### 编译过程

计算机硬件只能通过电的有无或者高低两种状态来表示信息，一般用二进制0和1，所以机器指令的能被硬件识别的二进制位串。指令中既包含了操作类型，也包含了数据。

编写程序的方式的发展过程是最开始直接编写二进制指令，之后发明了与二进制指令一一对应的汇编语言，通过汇编器将汇编代码翻译为二进制指令，再之后发展除出了高级编程语言编写程序，然后交给编译器编译为汇编语言，然后再翻译为机器语言（可能高级程序语言编写的代码被编译器直接编译为机器语言）。



### 硬件组成

1. 运算器：负责算数与逻辑运算
2. 控制器：负责解析指令并根据解析的结果指挥各个部件工作
3. 存储器：程序运行时的存放位置，也存放程序运行时产生的数据
4. 输入设备
5. 输出设备

运算器又称为数据通路，它和控制器一起合称为处理器。

运行内存由DRAM（动态随机访问存储器）组成，存放程序的数据与指令，可以实现随机访问内存地址。在处理器的内部有另一种存储器——高速缓存（cache memory）。高速缓存速度更快，但电路结构复杂集成度低于运行内存，价格高，一般作为DRAM的缓冲。高速缓存采用的存储技术是——静态随机访问存储器（SRAM）



### 计算机组成原理和计算机体系结构

硬件的直接上层就是计算机组成原理，软硬件之间的是计算机体系结构，而计算机组成原理的直接上层是计算机体系结构。

计算机组成原理：重点讲如何实现，实现的细节。

计算机体系结构：是采用分析加上评测的方式，来说明为什么在计算机系统设计中要这样设计。

> 比如cache是计算机系统中非常重要的一个部件，它大大提升计算机系统的速度，特别是对内存中的数据和指令的存取速度，cache有多种组织方式，比如组相联，直接相联和全相联，其中在组相联中又有两路组相联，四路组相联，八路组相联。假如选择了组相联这种方式对cache进行组织，那么我们设计的计算机系统适合两路组相联，四路组相联，八路组相联中的哪种，就需要分析加评测。   
>
> 比如一条指令是否引入到我们的计算机的指令集中，也采用分析加评测的方式来确定引入的优势和不引入的劣势，以及是否引入到设计的计算机系统中。 一旦该指令被确定引入系统中，那么计算机组成层面给就要确认用什么样的方式（逻辑电路）来实现该指令。



### 存储

易失性存储器和非易失性存储器。

易失性存储器：主存储（main memory）

非易失性存储器：辅助存储（secondary memory）



### 计算机网络

一台计算机在外部通过计算机网络来与其他计算机通信，以扩展自身的计算能力。通过计算机网络，可以实现如下能力：

1. 通信
2. 共享硬件设备
3. 远距离控制其他计算机

根据传输速度和距离，可以区分网络类型为：

1. 以太网
2. 基于以太网形成的局域网（Local Area Network,LAN）
3. 广域网



### 性能

性能的定义，从不同的角度来定义性能，得到的结果也是不同的。

一般的性能评价指标：

1. 响应时间：计算机完成某个任务所需要的总事件，包括硬盘访问，内存访问，I/O活动，操作系统开销和CPU执行时间等。
2. 吞吐率：单位时间内完成任务的数量。



性能和响应时间之间的关系：

$性能~x = \frac{1}{执行时间~x}$



**执行时间**

1. 挂钟时间（响应时间），完成某项任务所需要的总时间，包括硬盘访问，内存访问，I/O活动，操作系统开销和CPU执行和切换时间等。
   但是计算机总是同时运行多个程序，所以一般需要将某个程序运行的时间和挂钟时间区分开来。
2. CPU时间，CPU执行某个程序所花费的时间，不包括等待I/O或CPU执行其他程序的时间。CPU时间还可以进一步分为用于用户程序的时间（用户CPU时间）和操作系统为用户程序执行相关任务花费的CPU时间（系统CPU时间）。





计算机设计者更注重硬件完成基本功能的速度，而计算机应硬件是以时钟信号来驱动的，这种离散的时间间隔被称为时钟周期。时钟周期的表示方式可以直接用具体的时间多少来表示，比如（250皮秒），也可以使用具体时间（时钟周期长度）相对于1秒的倒数，即时钟频率，比如4GHz。





### CPU性能

CPU执行时间与时钟周期数和时钟周期长度的关系：
$$
程序的CPU执行时间 =  程序的CPU时钟周期数*时钟周期长度
$$


或者
$$
程序的CPU执行时间 = \frac{程序的CPU时钟周期数}{时钟频率}
$$


另一种计算程序CPU执行时间的方法是：因为每个程序都是被编译为具体的机器指令，而指令都是在CPU上被一条条执行的，因此CPU执行时间必定和程序对应的指令数成正比。所以这个角度下，CPU执行时间的公式如下：
$$
程序的CPU执行时间 = 程序的指令数 * 指令平均时钟周期数 / 时钟频率
$$

$$
CPU时钟周期总数 = 程序的指令数 * 指令平均时钟周期数
$$


指令平均时钟周期数（clock cycyle per instruction）：表示执行每条指令所需要的时钟周期平均数——CPI。

具体的不同指令，因为需要完成的操作不同，所需要消耗的时钟周期数量是不同的，而CPI是所有指令



