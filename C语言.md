# C语言

目标：

1. 具备扎实的C编程能力
2. 熟练地使用Linux系统
3. 对计算机体系结构与指令集、操作系统原理和设备驱动程序都有较深入的了解

大学的计算机专业：微积分、线代、随机、离散、组合、自动机、编译原理、操作系统、计算机组成原理等一堆基础课，再加上C/C++、Java、数据库、网络、软件工程、计算机图形学等一堆专业课



可以自学，但并非所有课都能自学。前期课程中，代码量小，封装简单，所以前后代码之间逻辑性很强，只要努力，按照一定方法，是能够看懂的。后期的代码，可能进行了大量的封装，两行代码之间可能没有任何直接逻辑，所以这时看代码就有可能很难看懂，如果有人告诉你，那么效率则是非常高的。所以市面上真正好的书籍则是哪些告诉你这些代码之间逻辑的书籍和视频。

学习一个知识点时，考虑：

- 为什么需要学习这个知识点
- 这个知识点是什么
- 怎么使用这个知识点
- 要注意的问题
- 知识点应用的领域
- 知识点是否重要

## C语言概述

- 为什么要学习C语言
- 怎样学习C语言
- 学习C语言要达到的效果
- 学习java前建议先学习C语言





## 第一章

- C语言的起源和特性
- C语言的优缺点
- 编程的起源和基本原则
- C语言的开发环境



### 起源

1972年由里奇和汤普逊在贝尔实验室基于B语言设计，用它来编写Unix操作系统。

### 优点

- 融合计算机科学理论和实践的控制特性，可以轻松的完成自顶向下的规划，结构化编程和模块化设计

- 高效，运行速度快，具有通常汇编语言才有的微调控能力，可以根据具体情况微调程序，实现最大运行速度或最有效的使用内存

  > 汇编语言是为CPU设计的一系列内部指令，使用助记符标识；不同的CPU系列使用不同的指令集和汇编语言

- 可移植性，在一种系统中编写的C程序稍作修改或者不修改就能在其他系统中运行，许多计算机体系结构中都可以使用C编译器。

  > C编译器是把C语言代码转换为计算机内部指令的程序。因为Unix是使用C语言编写的，所以Unix操作系统的软件包中默认含有C编译器；安装Linux时，通常也会安装C编译器。其他操作系统也有各自系统下的C语言编译器。

- 功能强大且灵活，操作系统基本都是使用C语言编写，其他语言的编译器和解释器大都由C语言编写

- C语言可以访问硬件，操控内存中的位，丰富的运算符

- 大多数C实现都有一个大型的库，包含众多的C函数，可以随时被调用



### 缺点

- 容易在指针方面出编程错误而不易察觉
- 写法可以多样



### 应用范围

- 编写操作系统
- 编写应用程序
- 计算机游戏
- 嵌入式开发
- 开发其他编程语言
- ...



### 计算机组成

- CPU：运算和逻辑处理单元
- RAM：存储程序指令和数据
- 磁盘：永久内存存储
- 外设：提供输入和输出



### CPU的工作原理

CPU通过内存地址从内存中获取一条指令并执行它，然后再从内存中获取并执行下一条指令（1GHz一秒钟大约可以执行这样的操作10亿次）。CPU有自己的小工作区域——一个个的寄存器，每个寄存器都可以存储一个一组二进制数字组成数据。

 一个寄存器存储下一条指令的内存地址，CPU使用该地址来获取和更新下一条指令。

在获取指令后，CPU在另一个寄存器中存储该指令，并更新第一个寄存器来存储下一条指令的地址。

> CPU能理解的指令有限（指令的集合叫指令集），而且这些指令相当具体，其中许多指令都是用于请求计算机把一个数字从一个位置移动到另一个位置。比如，从内存移动到寄存器。

计算机中的所有数据都是以二进制数字来表示的，包括程序的指令和数据（其他进制的数字，字符，字符串等）。每个字符在不同的字符集中都有各自的二级制表示。程序则直接由编译器等直接转为机器指令（指令就是一组二进制数）。



### 编译器

一般不同的CPU制造商使用不同的指令系统和指令对应的不同的汇编语言，同时编码格式也不同，不同CPU的机器语言不能在其他CPU中处理。**但编译器针对不同的CPU系列有特定的类型与之对应**。因此，使用合适的编译器或者编译器集，可以把一种高级语言转为提供给不同CPU执行的机器语言程序。  编译器实现了跨CPU架构，导致语言可以不用关注CPU架构方面的细节。



### 语言标准

现在有不同的C实现。理想情况下，编写的同一段C语言代码程序（其中不含有针对特定平台的技术），那它在任何实现C语言的计算机中被执行，执行的结果都应该是相同的。为此，就需要不同的实现都遵循一个标准。这些标准定义了C语言及其标准库。

0. 最初没有C标准，C语言创造者的《C语言程序设计》被公认为第一版C标准，但这本书中只定义了C语言，没有定义C语言库，所以Unix实现提供的库也就成为了标准库
1. C89标准，它定义了C语言和C标准库

1. C99标准，目的不是添加新特征，而是支持了国际化，弥补原来C语言中的明显缺陷，提高计算的适应性，C99的改动并非所有编译器都完全实现了，因此，可能发现一些改动在自己的系统中不可用或者只有改变编译器的设置后才能使用。
2. C11标准，编译器供应商并未像对C90那样很好地接受和支持C99，这使得C99中的一些特征在C11中变成了可选项



### 编写C语言程序的步骤

1. 定义程序的目标
   - 明确程序的想要处理的问题
   - 思考当前已经有什么信息
   - 程序的流程

2. 设计程序

   - 用户界面
   - 程序组织
   - 程序耗时

3. 编写代码

4. 编译
   编译的细节取决于编程环境，C编译器编译源代码时，还将源代码和C库（库中包含大量的标准函数供用户使用，如printf，scanf）的代码合并成最终执行的程序（准确的说是由一个被称为链接器的程序来链接库函数，在大多数系统中，编译器运行链接器）。

   > 不同的计算机CPU使用不同的指令集。特定C语言的编译器将C代码编译为特定的机器语言代码。

5. 运行程序

6. 测试和调试程序

7. 维护和修改代码



### 编程机制

C语言程序源代码到可执行文件，在典型的C实现中通过  **编译**和  **连接**两个步骤来实现，这样方便程序进行模块化，可以独立编译指定的模块，然后再用链接器合并已编译的模块。通过这种方式，如果只更改了某个模块，不必因此重新编译其他模块。

1. 编译器将源码转为中间代码

2. 链接器将中间代码和其他代码、预编译的库代码合并，生成可执行文件

   

中间文件有很多形式，其中最普遍的是把源代码转换位机器语言代码，并把结果放在目标代码文件中，虽然目标代码文件中包含机器语言代码，但是并不能直接运行该文件，因为目标文件中存储的是编译器翻译的源代码，还不是一个完整的可执行程序。

目标代码文件缺失启动代码， **启动代码**充当着程序和操作系统之间的接口。同时不同的操作系统，如windows和Linux所需要的启动代码不同，因为它们处理程序的方式不同。

同时 **目标代码**还缺少了库函数，几乎所有的C语言程序都要使用C标准库中的函数，如printf函数等， 目标代码文件不包含该函数的代码，只包含使用printf函数的指令，printf函数真正的代码存储再另一个被称之为 **库** 的文件中，库文件中有许多的函数的目标代码。

**链接器**的作用是，将**开发者编写的目标代码**、**系统的标准启动代码**和**库代码** 这3部分合并成一个可执行文件。

**对于库代码，链接器只会将程序中使用到的库函数代码提取出来。**

参考下图：

![image-20220920212012643](.\images\image-20220920212012643.png)



总结：**目标文件和可执行文件都是由机器语言指令组成，而目标文件中只包含编译器编译的开发者编写的源代码对应的机器语言代码，而可执行文件中除了包含目标文件中的代码外还有一些程序中使用到的库函数和启动代码对应的机器代码。**

一些系统必须分别运行编译程序和链接程序，而另一些系统中，编译器会自动启动链接器，用户只需要给出编译命令即可。



### 编译器

GNU项目中有大量的免费UNIX软件，GNU编译器集合也称为GCC，其中包含GCC C编译器，GCC C编译器是该项目的产品之一。GCC有各种版本，以适应不同的硬件平台和操作系统，包括UNIX，Linux和windows。用**gcc命令**便可以调用GCC C编译器。

LLVM项目中有另一个C语言编译器实现，这个项目是与编译器相关的开源软件集合。该项目中的C语言编译器叫Clang编译器，可以通过 **clang**调用。

GUN和LLVM都可以使用-v选项来显示版本信息，各个系统都使用cc别名来代替gcc或clang命令。

```
cc -v   // 查看使用的编译器及其版本
```

gcc和clang可以通过不同的命令行选项来调用不同C标准。

```
gcc -std=c99 test.c  // 用c99标准
gcc -std=c1x test.c  // 用GCC接受C11之前的草案标准
gcc -std=c11 test.c  // 使用C11标准版本

// clang也一样
```

### Unix中的C编译器

Unix操作系统是由C语言编写的，所以操作系统内置了C编译器程序作为系统软件包的一部分。在Unix操作系统中使用cc命令作为C编译器的别名。

### Linux中C编译器

Linux是一个开源的类Unix操作系统，可以在PC和Mac上运行。在Linux中需要使用GNU提供的GCC公共域C编译器，编译命令：gcc test.c

在安装Linux时，可选择是否安装GCC，如果之前没有安装GCC，则必须安装。通常，安装过程会将cc作为gcc的别名，因此可以在命令行中使用cc来代替gcc。

GCC的基本用法： gcc [options] [filenames]



### windows中C编译器

C编译器不是标准Windows软件包的一部分，因此需要从外部获取安装C编译器。可以下载Cygwin和MinGW，然后在PC的命令行中使用GCC编译器。Cygwin有自带的视窗运行，仿inux命令行环境。MinGW在windows的命令提示模式中运行。Borland的C++编译器5.5也支持C90。



通常，C编译器生成的中间目标代码文件的扩展名是.obj。



### 集成开发环境（Windows）

目前，大多数IDE都是C和C++结合的编译器。市面上的IDE有Microsoft Visual Studio Express和Pelles C。利用集成开发环境可以快速的开发C程序，可以编写源码，编译程序，运行程序，调试的能力。

Microsoft Visual Studio Express提供了多种目标。即运行程序的多种环境，如32位Windows程序，64位Windows程序，动态链接库文件（DLL）等。





## 第二章

### 实例代码

```c
# include <stdio.h>
int main(void)
{
    int num;
    num = 1;
    printf('aaa ');
    printf('bbb\n');
    printf('ccc %d',num);
    return 0
}
```

输出：

> aaa bbb
> ccc 1

在运行编译执行上述程序后，可能命令行窗口执行完程序后瞬间就关闭了。如果想要防止自动关闭窗口，可以在函数的return语句之前加上getchar()代码，这行代码会等待敲击enter键后继续往后执行。



### 代码解释

C语言程序的几个部分：

![image-20220925182726956](.\images\image-20220925182726956.png)

```c
# include <stdio.h>
```

该行代码的作用相当于把stdio.h文件中的所有内容都拷贝粘贴到该行代码所在的位置，引入文件。

stdio.h是编译器软件包的标准部分，它内部提供了供给编译器使用的键盘输出和屏幕输出的一些列函数。叫标准输入输出头文件。

 `# include`是一条C预处理器指令。 C编译器在编译前对源码做一些准备工作（预处理）。通常。在C程序顶部的信息集合被称为 **头文件**。大多数情况下，头文件中包含了编译器创建最终可执行程序要使用到的信息。

头文件中可以定义一些常量，或者指明函数名以及如何使用它们。但是，函数实际对应的代码在一个预编译代码的库文件中。

C语言表标准中规定了C编译器必须提供的头文件有哪些。C语言的实现文档中有对C库函数的说明，说明哪些函数的功能是什么，在哪个库中。

`#`号表示C预处理器在编译器编译之前处理该条指令。

```
int main(void)
```

main函数，C程序的项目入口文件mian函数，整个项目只能有且仅有一个main函数。 函数名前面的int表示函数的返回值的类型是整型，main函数的返回值返回给操作系统。



```c
/* 多行或者单行注释 */
// C99标准中新增的单行注释方式
```



```c
{
    // 花括号表示函数体的开始和结束   或者 表示将多条语句合并为一个单元或者块
}
```



```c
int num;  // 声明一个叫num的变量，同时变量允许存放整型的数据
```

int（关键字）是C语言中的一种数据类型——整型

num（标识符）也就是一个变量名或者函数名或者其他实体的名字。

声明：把特定的标识符和计算机中的特定的位置联系起来，同时也确定了存储在该内存位置的信息类型或数据类型。

> 在C语言中所有的变量都必须先声明再使用。

之前C语言要求将变量声明在块的顶部，其他语句不能在任何声明语句的前面，如：

```c
int main(void)
{
    int num;
    int num2;
    int str;
  	// ...
    num = 2;
    num1 =3
    // ...
    return 0
}
```

C99和C11遵循C++的惯例，可以把声明放在块的任何位置，尽管如此，首次使用变量之前一定要先声明它。如下：

```
int main(void)
{
  	// ...
  	int num;
    num = 2;
    // ...
    int num2;
    num1 =3
    // ...
    return 0
}
```



### 变量名

可以使用小写字母，大写字母，数字和下划线来命名变量名。而且第一个字符不能是数字。

![image-20220925191244341](.\images\image-20220925191244341.png)

> 操作系统和C库经常使用一个或者两个下划线字符开始的标识符，因此开发者最好避免在自己的程序中这么使用，以避免命名冲突。

区分大小写，star和Star是不同的变量名。



### 使用多个函数

```c
# include <stdio.h>
void fun(void)  // 函数原型或者函数声明,告诉编译器在程序中要使用该函数，当编译器运行到该行后，会在后面检查fun函数使用是否符合它的定义
int main(void)
{
  	fun()  // 函数调用
    return 0
}

void fun(void)  // 定义函数， 也可以写在main函数之前，只是惯例是把main函数放在开头，因为它是程序的入口
{
   // ...
}
```

> C标准建议，为程序中用到的所有函数提供函数原型，标准include文件为标准库函数提供函数原型。例如，在C标准中，stdio.h文件包含printf函数的原型。





## 第三章

- 如何读取数据；如何操控数据。

- 整数类型和浮点数类型是什么，如何声明，如何使用。
- 常量和变量

```c
int main(){
    float weight;   // 浮点型数据
    
    printf("... %d ...");  //%d表示用整型数据来填充该位置
    printf("... %f ...");  //%f表示用浮点数数据来填充该位置
    printf("... %.2f ...");  //%.2f表示控制输入精度为小数点后两位
    
    scanf("%f",&weight)  // 该函数用于读取键盘输入,%f说明scanf函数要读取用户从键盘输入的浮点数，&weight表示告诉scanf输入的值赋值为weight变量，&表示找到weight变量的内存地址。   &地址符 取地址
}
```



![image-20220926182544130](.\images\image-20220926182544130.png)

int：整数类型

long、short、unsigned、signed用于扩展整数类型，比如：unsigned short int、long long int。

char：字符串类型

float、double和long double表示带小数点的数

_Bool：表示布尔类型

_complex：表示复数

_Imaginary：表示虚数



整数类型和浮点数类型的存储方式不同。

![image-20220926193552104](.\images\image-20220926193552104.png)



计算机将浮点数分为小数部分和指数部分，，而且是分开存储的。虽然7.00和7在数值上一样，但是它们的存储方式可不相同。在十进制下，7.0可以写为0.7E1，0.7是小数部分，1是指数部分。

![image-20220926194105847](.\images\image-20220926194105847.png)

浮点数通常是实际值的近似值，如7.0可能被存储为浮点值6.999999，过去浮点数的运算比整数的运算慢，不过，现在许多CPU内部都包含浮点数处理器，缩小了速度上的差距。



> 字：是设计计算机时给定的自然存储单位，对于8位的微型计算机，1字长只有8位，后来的16位，32位和64位都是字长，计算机的字长越大，其数据转移越快，能够访问的内存地址越多。

### 基本数据类型

#### int

int类型及其细分类型（即多种整数类型），针对不同情况选择不同的类型，以表示不同的取值范围和正负值。

int表示有符号的整型（正负整数或者0），它能表示的取值范围根据计算机系统而异，一般来说，存储一个int要占用一个机器字长，16位计算机存储的一个int值的取值范围是：-32768~32767（），32位和64位系统的取值范围相应增大。

```c
int erns;
int hogs, cows, goats;

// 变量赋值
cows = 1;

scanf("%d",&hogs);

int count = 10, num = 9;
```



![image-20220926200054495](.\images\image-20220926200054495.png)

C语言把不含小数点和指数的数作为整数。

在C语言中，使用特定的前缀表示使用哪种进制。0x或者0X前缀表示16进制值，十进制的16用十六进制表示是：0X10。前置为0表示8进制。十进制的16用八进制表示是：020。

不同进制对应的转换说明符号：

- %d：将数字以十进制表示数据
- %o：将数字以八进制表示数据
- %x：将数字以十六进制表示数据

```c
#include <stdio.h>
int main(void)
{
    int x = 100;
    printf("dec=%d;octal=%o;hex=%x \n",x,x,x);
    printf("dec=%d;octal=%#o;hex=%#x \n",x,x,x);
    return 0
}

// dec=100;octal=144;hex=64
// dec=100;octal=0144;hex=0x64
```



#### 其他整数类型

C语言提供了3个附属关键字修饰基本整数类型：short、long和unsigned。

- short int类型（简写short）占用的存储空间可能比int类型少，用于有符号较小数值，节省空间。
- long int类型（简写long）占用的存储空间可能比int类型多，适用于有符号较大数值。
- long long int类型（简写long long） 占用的存储空间可能比long类型多，适用于更大的有符号数值，该类型至少占64位。
- unsigned int（简写unsigned）只用于非负值场合，用于表示符号位的二进制位用于参与表示数值。
- 其他组合数据类型

在任何有符号类型前面添加关键字signed可以强调使用有符号类型的意图。



声明其他类型的整数：

```c
long int num1;
long num2;
short int num3;
short num4;
unsigned int num5;
long long num6;
```



C语言规定short占用的存储空间不能多于int类型，long占用的存储空间不能少于int。目的是为了适应不同的机器。

占用空间变化：

int和short都占16位，long占32位 => short占16位，int和long占32位=> short 占16位，int占16位或者32位，long占32位，long long 占64位。







初识C语言

什么是计算机语言

什么是C语言

人与计算机交流的语言



机器语言

汇编语言



学习程序设计的目的：不一定是要自己写一个软件，而是通过学习它，来理解计算机是怎么工作的，计算机能做、擅长和不容易做、不擅长的事。

计算机解决问题方式：需要一步一步的告诉计算机具体要做的事情的步骤。计算机只会按照规定一步一步的做一些特定的事情。同时它能做其中的每一步的事情，但是它不知道如何顺序的执行这些步骤。

开发这就是在按照顺序编写和组织这些步骤。
