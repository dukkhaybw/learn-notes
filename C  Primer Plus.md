# C  Primer Plus

- 基本概念
- 编程技巧



- 预备知识
- 数据类型
- 格式化输入/输出
- 运算符
- 表达式
- 语句
- 循环
- 字符输入和输出
- 函数
- 数组和指针
- 字符和字符串函数
- 内存管理
- 文件输入和输出
- 结构
- 位操作
- C预处理器
- C库
- 高级数据表示



## 第一章

- C语言的历史
- 语言的优缺点
- 编程历史和基本原则
- C语言的运行环境



### 历史

72年，里奇和汤普逊在贝尔实验室为了开发Unix操作系统而设计了C语言，它基于B语言设计的。



### 优缺点

优点：

- 融合了计算机科学理论和实践的控制特性，能让用户能轻松地完成自顶向下的规划、结构化编程和模块化设计。

- 高效，C程序相对更紧凑，而且运行速度很快，C语言具有通常是汇编语言才具有的**微调控制能力**，可以写出速度和内存使用都非常优秀的程序

  > 汇编语言是为特殊的中央处理单元设计的一系列内部指令，使用助记符来表示；不同的CPU系列使用不同的汇编语言

- 可移植，在一个系统中编写的C程序不需要或者稍作修改就能在其他系统运行。如需修改，也只需简单更改主程序头文件中的少许项即可。许多计算机体系结构都可以使用C编译器。

  > C编译器是把C代码转换成计算机内部指令的程序。
  >
  > 因为Unix操作系统是使用C语言写的，所以UNIX系统通常会将C编译器作为软件包的一部分，默认一并安装。
  >
  > 个人PC的不同版本和系统都能找到对应的C编译器。

- 功能强且灵活，其他多数语言的编译器和解释器都是C语言编写的。

- 可以访问硬件、操控内存中的位，可以访问硬件、操控内存中的位，代码可以写的很简洁。

- 大多数C实现都有一个大型的库，包含众多有用的C函数，可以直接被开发者使用。



缺点：

- 写法多样且灵活，导致一些代码可以写得难理解
- 涉及指针的编程错误往往难以察觉



### 应用范围

- 编写操作系统
- 开发应用层应用
- 开发编译器
- 开发游戏
- 嵌入式系统
- ...

> C++在C语言的基础上嫁接了面向对象编程工具（面向对象编程是一门哲学，它通过对语言建模来适应问题，而不是对问题建模以适应语言）
>
> 许多的微处理器都用C语言进行编程。



扩展：

学习计算机的工作原理，理解用C语言编写程序和运行C程序时所发生的事情。

现代计算机的硬件组成：

1. 中央处理单元（CPU），承担绝大部分的运算
2. 随机存取内存（RAM），存储程序和文件的工作区
3. 永久内存存储设备，硬盘
4. 各种外围设备，提供人与计算机之间的交互

CPU的工作大致流程：

它从内存中获取并执行一条指令，然后再从内存中获取并执行下一条指令。CPU中的寄存器可以存储数据。一个寄存器存储下一条指令的内存地址，CPU使用该地址来获取和更新下一条指令。在获取指令后，CPU在另一个寄存器中存储该指令，并更新第1个寄存器存储下一条指令的地址。CPU能识别的指令组成的集合被叫做指令集。存储在计算机中的所有内容都是二进制数字的组合。

编译器是把高级语言程序翻译成计算机能理解的机器语言指令集的程序。 

一般而言，不同CPU制造商使用的指令系统和编码格式不同。例如，用Intel Core i7（英特尔酷睿i7）CPU编写的机器语言程序对于ARM Cortex-A57 CPU而言什么都不是。但是，可以找到与特定类型CPU匹配的编译器。因此，使用合适的编译器或编译器集，便可把一种高级语言程序转换成供各种不同类型CPU使用的机器语言程序。



### C语言标准

市面上有多种C语言实现，在理想情况下，编写C程序时，假设该程序中未使用机器特定的编程技术，那么它的运行情况在任何实现中都应该相同。为了尽可能的恶实现这个需求，那么不同的实现要遵循同一个标准。

C语言从早期的非正式的K&R标准（定义了C语言，但没有定义C库，为此，UNIX实现提供的库成为了标准库），发展到1990 ISO/ANSI标准，即C89或者C90（定义了C语言和C标准库），再到C99（支持国际化编程，解决前面标准的中明显缺陷，适应科学和工程中的关键数值），并非所有的编译器都完全实现C99的所有改动，再发展到2011 ISO/IEC标准（添加了可选项支持当前使用多处理器的计算机）。



C是编译型语言。

编写程序的步骤：

1. C是编译型语言，写代码前，明确需求目标，思考你的程序需要哪些信息，要进行哪些计算和控制，以及程序应该要报告什么信息。

2. 设计程序，如何表示数据，以及用什么方法处理数据，选择一个合适的方式表示信息可以更容易地设计程序和处理数据

3. 编写代码

4. 编译源代码，编译的细节取决于编程的环境，不同的计算机使用不同的机器语言方案（指令集）。C编译器负责把C代码翻译成特定的机器语言。此外，C编译器还将源代码与C库（库中包含大量的标准函数供用户使用，如printf()和scanf()）的代码合并成最终的程序。

   > 更精确地说，应该是由一个被称为链接器的程序来链接库函数，但是在大多数系统中，编译器运行链接器

5. 运行程序，在常见环境（包括Windows命令提示符模式、UNIX终端模式和Linux终端模式）中运行程序要输入可执行文件的文件名，而其他环境可能要运行命令或一些其他机制。例如，在Windows和Mac提供的集成开发环境（IDE）中，用户可以在IDE中通过选择菜单中的选项或按下特殊键来编辑和执行C程序。最终生成的程序可通过单击或双击文件名或图标直接在操作系统中运行。

6. 测试和调试程序

7. 维护和修改代码

应该养成先规划再动手编写代码的好习惯，用纸和笔记录下程序的目标和设计框架。



### 编程机制

生成程序的具体过程因计算机环境而异。C语言编写的项目可以放在UNIX、Linux、、Windows和Macintosh OS等系统下编译为可执行文件。了解计算机是怎么编译C语言编写的项目为可执行文件程序。

源代码文件，要求文件名以.c结尾，文件名应该满足特定计算机操作系统的特殊要求。

典型的C实现通过**编译和链接**两个步骤来完成将C源代码文件转换为可执行文件。编译器把源代码转换成中间代码，链接器把中间代码和其他代码合并，生成可执行文件。

分为两个步骤方便对程序进行模块化，可以独立编译单独的模块，稍后再用链接器合并已编译的模块。通过这种方式，如果只更改某个模块，不必因此重新编译其他模块。另外，链接器还将你编写的程序和预编译的库代码合并。



#### 目标代码文件

目标代码文件是一种中间文件。把源代码转换为机器语言代码，并把结果放在目标代码文件中，虽然目标文件中包含机器语言代码，但是并不能直接运行该文件。因为目标文件中存储的是编译器翻译的源代码，这还不是一个完整的程序。

目标代码文件缺失启动代码（startup code）。启动代码充当着程序和操作系统之间的接口。虽然同一台电脑上的不同操作系统（Windows和Linux）的CPU指令集相同，但是Windows和Linux所需的启动代码不同，因为这些系统处理程序的方式不同。

目标代码还缺少库函数。几乎所有的C程序都要使用C标准库中的函数。目标代码文件并不包含该函数的代码，它只包含了使用printf()函数的指令。printf()函数真正的代码存储在另一个被称为库的文件中。库文件中有许多函数的目标代码。



#### 可执行文件

**通过链接器，把开发者编写的目标代码、系统的标准启动代码和库代码这3部分合并成一个文件，即可执行文件。对于库代码，链接器只会把程序中要用到的库函数代码提取出来（见图1.4）。**

<img src="/Users/wuyi/Desktop/study-note/images/image-20221028225853889.png" alt="image-20221028225853889" style="zoom: 50%;" />

总结：**目标文件和可执行文件都由机器语言指令组成的。然而，目标文件中只包含编译器为你编写的代码翻译的机器语言代码，可执行文件中还包含你编写的程序中使用的库函数和启动代码的机器代码。**



### 操作系统

#### Unix

使用通用的UNIX编辑器，如emacs、jove、vi或X Window System文本编辑器编写C语言代码。

Unix操作系统中编译C语言程序，使用操作系统自带的C编译器，执行命令：cc xxx.c。然直接输入打包生产文件的名字就可以执行该程序。

C编译器会创建一个与源代码基本名相同的目标代码文件，但是其扩展名是.o。一旦链接器生成了完整的可执行程序，就会将其删除。如果原始程序有多个源代码文件，则保留目标代码文件。

##### GNU编译器集合

GNU项目是一个开发大量自由UNIX软件的集合。GNU编译器集合，也被称为GCC，其中包含GCC C编译器是该项目的产品之一。GCC有各种版本以适应不同的硬件平台和操作系统，包括UNIX、Linux和Windows。用gcc命令便可调用GCC C编译器。



##### LLVM项目

该项目是与编译器相关的开源软件集合，它的Clang编译器处理C代码，可以通过clang调用。有多种版本供不同的平台使用，包括Linux。



GNU和LLVM都可以使用-v选项来显示版本信息，因此各系统都使用cc别名来代替gcc或clang命令。

gcc和clang命令都可以根据不同的版本选择运行时选项来调用不同C标准。

```shel
gcc -std=c99 inform.c[3]
gcc -std=c1x inform.c
gcc -std=c11 inform.c
```

第1行调用C99标准，第2行调用GCC接受C11之前的草案标准，第3行调用GCC接受的C11标准版本。Clang编译器在这一点上用法与GCC相同。



#### Linux

Linux是一个类UNIX的操作系统，可在不同平台（包括PC和Mac）上运行。在Linux中，使用GNU提供的GCC公共域C编译器。命令： gcc xxx.c

在安装Linux时，可选择是否安装GCC。如果之前没有安装GCC，则必须安装。通常，安装过程会将cc作为gcc的别名，因此可以在命令行中使用cc来代替gcc。



#### PC的命令行

C编译器不是标准Windows软件包的一部分，因此需要从别处获取并安装C编译器。可以下载Cygwin和MinGW，在PC上通过命令行使用GCC编译器。

源代码文件应该是文本文件，不是字处理器文件（字处理器文件包含许多额外的信息，如字体和格式等）。

通常，C编译器生成的中间目标代码文件的扩展名是.obj（也可能是其他扩展名）。与UNIX编译器不同，这些编译器在完成编译后通常不会删除这些中间文件。有些编译器生成带.asm扩展名的汇编语言文件，而有些编译器则使用自己特有的格式。

一些编译器在编译后会自动运行链接器，另一些要求用户手动运行链接器。在可执行文件中链接的结果是，在原始的源代码基本名后面加上.exe扩展名。



#### 集成开发环境（Windows）

集成开发环境(IDE)，集成开发环境，或称为IDE，如：Microsoft Visual Studio。这类集成开发环境都提供了各种菜单（如，命名、保存源代码文件、编译程序、运行程序等），用户不用离开IDE就能顺利编写、编译和运行程序。如果编译器发现错误，会返回编辑器中，标出有错误的行号，并简单描述情况。

IDE提供了多种目标（target），即运行程序的多种环境。例如，IDE提供了32位Windows程序、64位Windows程序、动态链接库文件（DLL）等。

Windows IDE既可处理C也可处理C++，因此要指定待处理的程序是C还是C++。有些产品用项目类型来区分两者，有些产品（如，Microsoft Visual C++）用.c文件扩展名来指明使用C而不是C++。当然，大多数C程序也可以作为C++程序运行。

在程序执行完毕后，执行程序的窗口立即消失。如果不希望出现这种情况，可以让程序暂停，直到按下Enter键，窗口才消失。要实现这种效果，可以在程序的最后（return这行代码之前）添加下面一行代码：

```
getchar();
```

几乎所有的C程序都能与C++程序兼容。所以，本书中的绝大多数C程序都可作为C++程序运行。或者，在选择C++选项后，将默认的源文件扩展名.cpp替换成.c，编译器便会使用C语言的规则代替C++。



#### Mac

Mac提供Xcode开发系统，Xcode使用Clang或GCC C编译器来编译C代码，它以前默认使用GCC，但是现在默认使用Clang。





GCC最基本的用法是：gcc [options] [filenames]，其中options是所需的参数，filenames是文件名。



## 第二章

### C示例代码

```c
#include <stdio.h>

int main(void)                    /* 一个简单的C程序 */
{       
     int num;                     /* 定义一个名为num的变量 该声明表明，将使用一个名为num的变量，而且num是int（整数）类型。*/
     num = 1;                     /* 为num赋一个值,把值1赋给名为num的变量。 */   

     printf("I am a simple ");    /* 使用printf()函数 该语句使用printf()函数，在屏幕上显示I am a simple，光标停在同一行。printf()是标准的C库函数。在程序中使用函数叫作调用函数。 */
     printf("computer.\n");  /*在上条语句打印出来的内容后面加上“computer”。代码\n告诉计算机另起一行，即把光标移至下一行。*/
     printf("My favorite number is %d because it is first.\n",num);  /*把num的值（1）内嵌在用双引号括起来的内容中一并打印。%d告诉计算机以何种形式输出num的值，打印在何处。*/

     return 0;  /*给调用方提供（或返回）一个数。*/
}
```

打印结果：

```
I am a simple computer.
My favorite number is 1 because it is first.
```



### 代码解释

某些窗口环境会在单独的窗口运行程序，然后在程序运行结束后自动关闭窗口。如果遇到这种情况，可以在程序中添加额外的代码，让窗口等待用户按下一个键后才关闭。一种方法是，在程序的return语句前添加一行代码：

```c
getchar()；
```

这行代码会让程序等待击键，窗口会在用户按下一个键后才关闭。



<img src="/Users/wuyi/Desktop/study-note/images/image-20221029005114323.png" alt="image-20221029005114323" style="zoom:50%;" />



```c
#include<stdio.h>        ←包含另一个文件
```

该行告诉编译器把stdio.h中的内容包含在当前程序中。stdio.h是C编译器软件包的标准部分，它提供键盘输入和屏幕输出的支持。

相当于把stdio.h文件中的所有内容都输入该行所在的位置。实际上，这是一种“拷贝-粘贴”的操作。include文件提供了一种方便的途径**共享许多程序共有的信息**。

#include这行代码是**一条C预处理器指令（preprocessor directive）**。通常，C编译器在编译前会对源代码做一些准备工作，即预处理（preprocessing）。



所有的C编译器软件包都提供stdio.h文件。该文件中包含了供编译器使用的输入和输出函数（如，printf()）信息。该文件名的含义是标准输入/输出头文件。通常，在C程序顶部的信息集合被称为头文件（header）。

在大多数情况下，头文件包含了编译器创建最终可执行程序要用到的信息。例如，头文件中可以定义一些常量，或者指明函数名以及如何使用它们。但是，函数的实际代码在一个预编译代码的库文件中。简而言之，头文件帮助编译器把你的程序正确地组合在一起。

这些说明确定了使用哪些函数需要包含哪些头文件。例如，要使用printf()函数，必须包含stdio.h头文件。

**特定C实现的文档中应该包含对C库函数的说明。**



```c
int main(void)        ←函数名
```

C程序都是从main()函数开始启动执行，一个C语言项目中不能有多个main函数

int表明main()函数返回一个整数（返回给操作系统），函数名后面的圆括号中包含一些传入函数的信息。该例中没有传递任何信息。因此，圆括号内是单词void，表明main()不带任何参数。



```c
/*一个简单的程序*/

// 单行注释，C99新增
```

被/* */两个符号括起来的部分是程序的注释（可以单行，多行）。



```
{
    ...
}
```

一般而言，所有的C函数都使用花括号标记函数体的开始和结束，还可用于把函数中的多条语句合并为一个单元或块。



```c
int num;  // 声明（declaration）
```

声明完成了:

1. 在函数中有一个名为num的变量（variable）
2. int表明num是一个整数

编译器使用这些信息为num变量在内存中分配存储空间。声明把特定标识符与计算机内存中的特定位置联系起来，同时也确定了存储在某位置的信息类型或数据类型。

在C语言中，所有变量都必须先声明才能使用。

以前的C语言，还要求把变量声明在块的顶部，其他语句不能在任何声明的前面。C99和C11遵循C++的惯例，可以把声明放在块中的任何位置。尽管如此，首次使用变量之前一定要先声明它。



标识符命名规则：**可以用小写字母、大写字母、数字和下划线（_）来命名。而且，名称的第1个字符必须是字母或下划线，不能是数字。**

<img src="/Users/wuyi/Desktop/study-note/images/image-20221029111303738.png" alt="image-20221029111303738" style="zoom:50%;" />

操作系统和C库经常使用以一个或两个下划线字符开始的标识符（如，_kcab），因此最好避免在自己的程序中使用这种名称。

C语言的名称区分大小写，即把一个字母的大写和小写视为两个不同的字符。因此，stars和Stars、STARS都不同。



```c
num = 1;
```

赋值表达式语句。在执行int num;声明时，编译器在计算机内存中为变量num预留了空间，然后在执行这行赋值表达式语句时，把值存储在之前预留的位置。可以给num赋不同的值。



```c
printf("I am a simple ");
printf("computer.\n");
printf("My favorite number is %d because it is first.\n", num);
```

上面使用C语言的一个标准函数：printf()。圆括号中的内容是从main()函数传递给printf()函数的信息——实参。

当程序运行到这一行时，控制权被转给已命名的函数（该例中是printf()）。函数执行结束后，控制权被返回至主调函数（calling function），该例中是main()。

\n的意思是换行（代表一个换行符（newline character））。

换行符是一个转义序列（escape sequence）。转义序列用于代表难以表示或无法输入的字符。如，\t代表Tab键，\b代表Backspace键（退格键）。每个转义序列都以反斜杠字符（\）开始。

%d相当于是一个占位符，其作用是指明输出num值的位置。%提醒程序，要在该处打印一个变量，d表明把变量作为十进制整数打印。printf()函数名中的f提醒用户，这是一种格式化打印函数。printf()函数有多种打印变量的格式，包括小数和十六进制整数。



```c
return 0;
```

int main(void)中的int表明main()函数应返回一个整数。C标准要求main()这样做。有返回值的C函数要有return语句。该语句以return关键字开始，后面是待返回的值，并以分号结尾。如果遗漏main()函数中的return语句，程序在运行至最外面的右花括号（}）时会返回0。因此，可以省略main()函数末尾的return语句。



### C程序的基本结构

程序由一个或多个函数组成，必须有main()函数。函数由函数头和函数体组成。函数头包括函数名、传入该函数的信息类型和函数的返回类型。通过函数名后的圆括号可识别出函数，圆括号里可能为空，可能有参数。函数体被花括号括起来，由一系列语句、声明组成。





### 多个函数

除main()以外，如何把自己的函数加入程序中。

```c
/* two_func.c -- 一个文件中包含两个函数 */
#include <stdio.h>
void butler(void); /* ANSI/ISO C函数原型 */

int main(void)
{
     printf("I will summon the butler function.\n");
     butler();
     printf("Yes. Bring me some tea and writeable DVDs.\n");

     return 0;
}

void butler(void) /* 函数定义开始 */
{
     printf("You rang, sir?\n");
}
```

输出结果：

```
I will summon the butler function.
You rang, sir?
Yes. Bring me some tea and writeable DVDs.
```



butler()函数在程序中出现了3次:

1. 第1次是函数原型（prototype），告知编译器在程序中要使用该函数；
2. 第2次以函数调用（function call）的形式出现在main()中；
3. 最后一次出现在函数定义（function definition）中，函数定义即是函数本身的源代码。

函数原型是一种声明形式，告知编译器正在使用某函数，因此函数原型也被称为函数声明（function declaration）。函数原型还指明了函数的属性。例如，butler()函数原型中的第1个void表明，butler()函数没有返回值（通常，被调函数会向主调函数返回一个值，但是butler()函数没有）。第2个void（butler(void)中的void）的意思是butler()函数不带参数。

程序的最后部分是butler()函数的定义，其形式和main()相同，都包含函数头和用花括号括起来的函数体。函数头重述了函数原型的信息：butler()不带任何参数，且没有返回值。



无论main()在程序文件中处于什么位置，所有的C程序都从main()开始执行。但是，C的惯例是把main()放在开头，因为它提供了程序的基本框架。

**C标准建议，要为程序中用到的所有函数提供函数原型。标准include文件（包含文件）为标准库函数提供了函数原型。例如，在C标准中，stdio.h文件包含了printf()的函数原型。**





## 第三章









