# HTTP 协议（超文本传输协议）

## 前言

HTTP，全称为超文本传输协议。在进行互联网络通信时使用的协议方案。最常见于 Web 浏览器和 Web 服务器之间的双工通信，有助于 Web 框架意识。

Web 浏览器、服务器和基于 web 浏览器的应用程序都是遵循 http 协议来彼此通信的。

## web 应用程序使用 http 进行通信

互联网中所有的通信过程都遵循某些或某种规则或者说协议。它规定了通信实体之间交换信息时应该采用的格式，要表达的意义和顺序以及接收到信息与发生的事件所采取的 ‘行为’。

通信协议（http、tcp、ip、skype 等）：

- 语法（结构和格式）
- 语义
- 时序

tcp/ip 协议族确定了如何确定通信目标地址，哪边先发起通信，如何结束通信，通信双方建立通信的顺序。

tcp/ip 协议族的分层（解耦）：

- 应用层（DNP,HTTP,FTP）
- 传输层：用于在两台处于连接状态的计算机之间进行数据传输
- 网络层：确定数据包的传输路径，
- 数据链路层：网络硬件部分

![image-20210320081258845](.\typora-user-images\image-20210320081258845.png)

​ ip 地址确定了数据包要去往的最终地址，mac 地址（网卡所属的固定位置）则是用于确定下一跳的目标地址（路由设备也有自生的 mac 地址和路由表）。寻找下一跳的协议是 ARP 协议。

​ tcp 位于传输层，它提供可靠的面向连接的字节流服务。字节流就是指为了方便传输，将大块的数据分割成以报文段为单位的数据包进行传输。tcp 能够准确可靠的把数据传给对方。为了能准确可靠的传输数据，在传输数据之前要先通过三次握手建立连接，并通过心跳机制确保连接的正常。

- 客户端发送 syn（握手包）

- 服务端接收到后发出一个含有 syn 和 ack 的数据包

- 客户端收到后发出一个 ack 数据包，完成握手

  如果握手过程中某个阶段中断，则 tcp 协议会再次以相同顺序发送数据包以建立连接。

DNS 服务：提供域名到 IP 地址之间的解析服务。

## http 概述

    > 浏览器,服务器和web应用之间通过HTTP协议进行通信。
    一种 protocol(通讯协议),能够获取如 HTML 这样的网络资源。
    > 通信内容:各种各样的数据与文件(资源)。

    > 资源分为:静态文件资源和根据需求生成内容的软件程序。

![image-20210308230158394](.\typora-user-images\image-20210308230158394.png)

### MIME

​ **媒体类型**（MIME）：互联网中服务器内存放的资源数据的类型，称为数据格式化标签。服务器在相应给客户端的所有 HTTP 对象数据附加一个 MIME 类型。浏览器在收到服务器响应的数据对象后，会查看数据对象的 MIME 类型，以决定是否能处理该资源类型(不能自己运行的是否可以用插件来解析运行)。

​ MIME 的详细信息存放在响应头的 content-type 中。

​ MIME 的表示格式： Content-Type：主要的对象类型（父类）/ 特定的子类型（子类）

常见文件的 MIME 类型:

> html: Content-Type: text/html; charset=utf-8
>
> 图片: content-type: image/jpeg
>
> 普通文本：Content-Type: text/plain
>
> ....

### URL

​ 服务器上的每一个资源都有自己的名称和它自己对应的地址,通过该地址就能在浏览器中获取到该资源.

​ 表示该地址的就是**URL（统一资源定位符）**：它描述了一台特定服务器上某资源的特定位置。

​ 所有的互联网机器真正的标识是 IP 地址而不是域名。

> **URL 的组成**
>
> 1. 协议类型（http://、file://..）:访问服务器以获取资源时要使用哪种协议。
> 2. 域名（主机名）：资源宿主服务器的主机名或者点分 IP 地址。
> 3. 端口号：服务器上对应软件运行的位置。
> 4. 路径：资源在服务器中的文件路径。
> 5. 参数
> 6. 查询字符串：以?开头的部分
> 7. hash：以#开头的部分

### HTTP 事务

一条 HTTP 事务由一条请求命令和一条响应结果组成。两部分都是以 http 报文(纯文本数据块)这样格式化的形式进行通信的。

#### **请求报文的组成：**

> 请求行:
>
>     1. 请求方式(get,post,delete，put,head,patch)
>     2. 资源路径
>     3. 协议版本
>
> 请求头:
>
>     1. 首部字段(键:值)
>     Host：www.xxxxxx.com
>     User-agent:Mozilla/5.67
>     Cookie:key=value;key=value
>     Content-Type:application/x-www-form-urlencoded   |  application/json   说明请求体格式
>     ...
>
> 请求空行
>
> 请求体:
>
>     1. get请求没有请求体
>     2. post请求的参数信息
>     key=value&key=value
>     {"key":"value","key":"value"}

#### 常见请求方式

http1.0：

get：偏向于获取资源的请求方式，可携带 query 参数

post：偏向于提供一些数据给服务器，参数位于请求体

put：偏向于提供一些数据给服务器用于更新数据

head：用来获取服务器头信息

http1.1：

delete：偏向于让服务器用于删除数据

connect：管道连接改为代理连接

patch：偏向于提供一些数据给服务器用于更新，修改，完善数据

options：用来获取服务端性能，但要服务端同意

#### **响应报文的组成:**

> 响应行:
>
>     1. 协议版本号
>     2. 状态码(200,302,404,500...)
>     3. 状态字符串(ok,redirect,not found...)
>
> 响应头:
>
>     1. 首部字段(键:值)[如:Content-Length:响应体长度,Content-Type:资源MIME类型]
>     Content-Type:text/html;charset=utf-8
>
> 响应空行
>
> 响应体:
>
>     装载了返回给客户端的数据（二进制数据或者文本）

#### 常见响应状态码

100~199：表示连接还在继续

200~299：表示各种意义上的成功

300~399：表示重定向

400~499：表示客户端错误

500~599：表示服务器端错误

101：连接继续

200：通用成功

301：永久重定向，该状态码标识该请求的资源已经被分配了新的 URL，以后要使用资源现在所指的 URL。

302：零时重定向，该状态码标识该请求的资源已经被分配了新的 URL，希望用户本次能使用新的 URL 访问。

304：缓存

400：表示请求报文中存在语法错误，当错误发生时，需要修改请求的内容后再次发送请求

403：访问权限不足

404：访问地址不存在

500：后端通用错误

501：服务器过载或维护者

503：表示服务器赞数处于超负载或者正在进行停机维护，现在无法处理请求

#### get 和 post 的区别：

get 的语义是获取，

get 请求的传参方式是 querystring，参数往往是直接跟在 url 的路径后面，不在请求体中。`http://www.baidu.com/home/index.html?name=jack&age=17`

get 请求可以被浏览器主动缓存

get 请求明文发送，只能发送编码过的 url，有中文会进行自动转码

post 的语义是给，

post 请求的传参方式是 requestBody 方式，参数不在地址栏而在请求体中。name=jack&age=17 或者 { “name”:"jack","age":17 }

post 请求不会被浏览器主动缓存

post 请求的数据格式需要在请求头中用 Content-Type 声明

### 连接

HTTP 是一个应用层协议。在建立了 TCP/IP 连接后，客户端和服务器之间的报文交换就能正常进行。

![image-20210107210132850](.\typora-user-images\image-20210107210132850.png)

在客户端向服务器发送报文之前，需要用网际协议（IP）地址和端口号在客户端和服务器之间建立一条 TCP/IP 连接。

从输入 URL 到接收响应完成过程：

1. 浏览器从 URL 中解析出服务器的主机名（域名）；
2. 浏览器将服务器的主机名通过 DNS(域名服务)转换成服务器的 IP 地址；
3. 浏览器将端口号（如果有，没有就默认 80 端口）从 URL 中解析出来；
4. 浏览器通过 ip 地址和端口号，在经过三次握手与服务器建立一条 TCP 连接，浏览器内核与远端服务器内核之间进行网络传输层的连接建立基于浏览器的内核与服务器进行，TCP 是一个面向连接的，可靠的传输协议。第一次握手：后端确定客户端发送正常，自己的接收正常第二次握手：客户端确定自己和服务器端发送和接收都正常第三次握手：后端确定自己的发送正常，客户端的接收正常
5. 浏览器向服务器发送一条 HTTP 请求报文；
6. 服务器向浏览器响应一条 HTTP 响应报文；
7. 关闭连接（四次挥手），接下来就是浏览器内部的具体过程。第一次挥手：客户端通知服务端响应体收到，准备断开连接第二次挥手：服务端确认客户端响应接收成功，并准备断开连接，第三次挥手：第四次挥手：断开连接，服务端关闭连接窗口

http 请求只能由前端主动发起，不能由后端主动发起；一个请求对应一件事

### web 应用

常见 web 应用：

1. web 浏览器

2. web 服务器

3. 代理服务器

   位于客户端和服务器之间的 HTTP 中间应用程序，接收所有来自客户端的 HTTP 请求并转发给服务器（可能会对请求进行修改后转发）。

4. 缓存服务器

   可以将经过代理传送的常用文档复制保存起来。下一个请求同一文档的客户端就可以享受缓存的私用副本提供的服务了。

5. 网关服务器

   作为其他服务器的中间实体使用，通常用于将 HTTP 流量转换为其他的协议。

6. 隧道

7. Agent 代理

   代表用户发起 HTTP 请求的客户端程序。

## HTTP 报文

### 报文流

HTTP 报文是在 HTTP 应用程序之间发送的数据块。

在 tcp/ip 协议中，IP 是用来定位互联网中的各个计算机的，而端口号则是用来定位这台计算机上的某个应用程序的。
