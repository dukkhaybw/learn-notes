# 串口通信

**定义**

串口通信：指仅用**一根接收线**和**一根发送线**就能将数据以**位**的方式进行传输的一种通讯方式。串口通信以位为单位的串行通信比以字节为单位的并行通信慢，但是串口通信结构简单。

典型的串口通信使用3根线完成，分别是地线、发送、接收。串口通信是**异步**的，所以端口能够在一根线上发送数据同时在另一根线上接收数据。

串口通信重要参数：

1. 波特率
2. 数据位
3. 停止位
4. 奇偶的校验

对于两个需要进行串口通信的端口，这些参数匹配是前提。

![img](https://pic1.zhimg.com/80/v2-cb92fb2b28bfcfc8b6bf14ea659c02c0_720w.webp)



**串口通讯的通讯协议**

串口通信的数据传输的都是0和1，在单总线、I2C、UART(通用异步收发器)中都是通过一根线的高低电平来判断逻辑1或者逻辑0。

早期：模拟信号输出简单过程量.

RS232接口：可以实现点对点的通信方式，但这种方式不能实现联网功能

RS485：差分通信、支持多机通信、抗干扰强



**串口通讯的物理层**

串口通讯的物理层标准：RS-232标准，RS-232标准主要规定了信号的用途、通讯接口以及信号的电平标准。

![img](https://pic3.zhimg.com/80/v2-92d11374a61489066bc335e509883296_720w.webp)



在上面的通讯方式中，两个通讯设备的"DB9接口"之间通过串口信号线建立起连接，串口信号线中使用"RS-232标准"传输数据信号。由于RS-232电平标准的信号不能直接被控制器直接识别，所以这些信号会经过一个"电平转换芯片"转换成控制器能识别的"TTL校准"的电平信号，才能实现通讯。

DB9标准串口通讯接口：

![img](https://pic1.zhimg.com/80/v2-98a215cc484ee5864f93c21eb8aefdd4_720w.webp)

![img](https://pic4.zhimg.com/80/v2-34523ba020a7e00e7427d235cc40b06f_720w.webp)

上表中的是计算机端的DB9公头标准接法，由于两个通讯设备之间的收发信号(RXD与TXD)应交叉相连，所以调制调解器端的DB9母头的收发信号接法一般与公头的相反，两个设备之间连接时，只要使用"直通型"的串口线连接起来即可。

![img](https://pic2.zhimg.com/80/v2-4cbe5232d92ad0fe3ed2d58acd1b96d5_720w.webp)



串口线中的RTS、CTS、DSR、DTR及DCD信号，使用逻辑 1表示信号有效，逻辑0表示信号无效。例如，当计算机端控制DTR信号线表示为逻辑1时，它是为了告知远端的调制调解器，本机已准备好接收数据，0则表示还没准备就绪。



**波特率**

指数据信号对载波的调制速率，它用单位时间内载波调制状态改变的次数来表示；

![img](https://pic2.zhimg.com/80/v2-7a2fb9d06b0039011762be908294b881_720w.webp)

比如波特率为9600bps；代表的就是每秒中传输9600bit，也就是相当于每一秒中划分成了9600等份。

因此，那么每1bit的时间就是1/9600秒=104.1666...us。约0.1ms。既然是9600等份，即每1bit紧接着下一个比特，不存在额外的间隔。两台设备要想实现串口通讯，这收发端设置的波特率必须相同，否则是没办法实现通讯的。



**串口通讯的数据结构**

![img](https://pic4.zhimg.com/80/v2-bfad8d6eb013f5b73c7a3414741e1287_720w.webp)

**起始位：** 起始位必须是持续一个比特时间的**逻辑0电平**，标志传输一个字符的开始，接收方可用起始位使自己的接收时钟与发送方的数据同步。

**数据位：** 数据位紧跟在起始位之后，是通信中的真正有效信息。数据位的位数可以由通信双方共同约定。**传输数据时先传送字符的低位，后传送字符的高位。**

**奇偶校验位：** 奇偶校验位仅占一位，用于进行奇校验或偶校验，奇偶检验位不是必须有的。如果是奇校验，需要保证传输的数据总共有奇数个逻辑高位；如果是偶校验，需要保证传输的数据总共有偶数个逻辑高位。

**停止位：** 停止位可以是是1位、1.5位或2位，可以由软件设定。**它一定是逻辑1电平**，标志着传输一个字符的结束。

**空闲位：** 空闲位是指从一个字符的停止位结束到下一个字符的起始位开始，表示线路处于空闲状态，**必须由高电平来填充**。





**STM32中的串口通讯**

STM32串口通信接口有两种，分别是：UART(通用异步收发器)、USART(通用同步异步收发器)，对于大容量STM32F10x系列芯片，分别由3个USART和两个UART。

![img](https://pic2.zhimg.com/80/v2-be87c02d1a5564098b84c05332f92e25_720w.webp)



TXD：数据发送引脚；RXD：数据输入引脚，这样两个芯片间可进行TTL电平通信。

但如果对于芯片和PC机相连，除了共地条件外，不能使用如上的直接交叉连接，虽然两者都有TXD和RXD引脚，但通常PC机使用的是RS232接口（9针），通常是TXC和RXD经过电平转换得到，故如果要使芯片与PC机的RS232接口直接通信，需要将芯片的输入输出端口也电平转换为RS232类型，再交叉连接，二者的电平标准不同：

单片机的点评标准(TTL电平）：+5V表示1，0V表示0；

RS232电平标准：+15/+13V表示0，-15/-13表示1。

因此单片机与PC机进行串口通信应该遵循：在单片机串口与上位机给出的RS232口之间，通过电平转换电路实现TTL电平与RS232电平间的转换.

如果使用USB转串口也可以实现串口通讯，USB转串口电路图如下所示：

![img](https://pic3.zhimg.com/80/v2-5f70019c01398b9f3a0a5f2e0edba932_720w.webp)









